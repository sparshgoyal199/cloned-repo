<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook Chatbot Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            height: 95vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .chat-interface {
            display: flex;
            flex: 1;
            min-height: 0;
        }

        .sidebar {
            width: 300px;
            background: #f8fafc;
            border-right: 1px solid #e2e8f0;
            padding: 20px;
            overflow-y: auto;
        }

        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            max-width: 85%;
            padding: 18px 22px;
            border-radius: 18px;
            line-height: 1.5;
            position: relative;
            word-wrap: break-word;
        }

        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            align-self: flex-start;
            background: #f1f5f9;
            color: #334155;
            border-bottom-left-radius: 5px;
            width: 100%;
            max-width: 100%;
        }

        .message-content {
            margin-bottom: 8px;
        }

        .message-time {
            font-size: 0.85rem;
            opacity: 0.7;
            text-align: right;
        }

        .user-message .message-time {
            color: rgba(255, 255, 255, 0.8);
        }

        .bot-message .message-time {
            color: #64748b;
        }

        /* Styles for HTML content responses */
        .html-response {
            width: 100%;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
        }

        .html-response iframe {
            width: 100%;
            border: none;
            background: white;
        }

        .input-container {
            padding: 20px 25px;
            border-top: 1px solid #e2e8f0;
            background: white;
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        #userInput {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            resize: none;
            min-height: 56px;
            max-height: 120px;
            font-family: inherit;
        }

        #userInput:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        #sendButton {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 28px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        #sendButton:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        #sendButton:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Info panel styles */
        .info-panel {
            margin-bottom: 25px;
        }

        .info-panel h3 {
            color: #334155;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .webhook-url {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #64748b;
            word-break: break-all;
            margin-bottom: 15px;
        }

        .quick-prompts {
            display: grid;
            gap: 10px;
        }

        .quick-prompt {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            color: #475569;
        }

        .quick-prompt:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
            transform: translateX(5px);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #dcfce7;
            border: 1px solid #86efac;
            border-radius: 8px;
            color: #166534;
            font-size: 0.9rem;
            margin-top: 20px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .container {
                height: 100vh;
                border-radius: 0;
            }

            .chat-interface {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e2e8f0;
                max-height: 250px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .message {
                max-width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Webhook Chat Assistant</h1>
            <p>Send queries to your n8n webhook and get HTML responses</p>
        </div>

        <div class="chat-interface">
            <div class="sidebar">
                <div class="info-panel">
                    <h3>Connected Webhook</h3>
                    <div class="webhook-url">
                        https://n8n-service-qi67.onrender.com/webhook/f1eb24d5-da4c-4ef2-b4bc-0c348260d417
                    </div>
                    <div class="status-indicator">
                        <div class="status-dot"></div>
                        Connected to webhook
                    </div>
                </div>

                <div class="info-panel">
                    <h3>Quick Prompts</h3>
                    <div class="quick-prompts">
                        <div class="quick-prompt" onclick="sendQuickPrompt('Generate morning digest for today')">
                            üìã Generate Morning Digest
                        </div>
                        <div class="quick-prompt" onclick="sendQuickPrompt('Show my tasks and priorities')">
                            ‚úÖ Show Today's Tasks
                        </div>
                        <div class="quick-prompt" onclick="sendQuickPrompt('Display email summary')">
                            üìß Email Summary
                        </div>
                        <div class="quick-prompt" onclick="sendQuickPrompt('Show meeting schedule')">
                            üìÖ Meeting Schedule
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-area">
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be inserted here -->
                    <div class="message bot-message">
                        <div class="message-content">
                            üëã Hello! I'm connected to your n8n webhook at:<br>
                            <code style="background: rgba(102, 126, 234, 0.1); padding: 2px 6px; border-radius: 4px; font-size: 0.9rem;">
                                https://n8n-service-qi67.onrender.com/webhook/f1eb24d5-da4c-4ef2-b4bc-0c348260d417
                            </code><br><br>
                            You can ask me to generate morning digests, task lists, or any other requests that your webhook handles.
                            Try using the quick prompts on the left or type your own message below!
                        </div>
                        <div class="message-time">Just now</div>
                    </div>
                </div>

                <div class="input-container">
                    <div class="input-wrapper">
                        <textarea 
                            id="userInput" 
                            placeholder="Type your message here... (e.g., 'Generate today's morning digest' or 'Show my schedule')"
                            rows="1"
                            oninput="autoResize(this)"
                            onkeydown="handleEnter(event)"
                        ></textarea>
                        <button id="sendButton" onclick="sendMessage()">
                            <span id="buttonText">Send</span>
                            <span id="buttonIcon">üöÄ</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const buttonText = document.getElementById('buttonText');
        const buttonIcon = document.getElementById('buttonIcon');

        const WEBHOOK_URL = 'https://n8n-service-qi67.onrender.com/webhook/f1eb24d5-da4c-4ef2-b4bc-0c348260d417';

        function formatTime() {
            const now = new Date();
            return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            
            // Check if content is an HTML document
            const isHTMLDocument = typeof content === 'string' && 
                                  (content.includes('<!DOCTYPE html>') || 
                                   content.includes('<html>'));
            
            if (isHTMLDocument) {
                // Create a toggle button
                const toggleButton = document.createElement('button');
                toggleButton.className = 'html-toggle-btn';
                toggleButton.innerHTML = 'üìÑ View HTML Report <span>‚ñº</span>';
                toggleButton.style.cssText = `
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 20px;
                    cursor: pointer;
                    margin-bottom: 10px;
                    font-weight: bold;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 8px;
                    width: 100%;
                    transition: all 0.3s ease;
                `;
                
                // Create iframe container
                const iframeContainer = document.createElement('div');
                iframeContainer.className = 'html-response';
                iframeContainer.style.cssText = `
                    display: none;
                    margin-bottom: 10px;
                `;
                
                const iframe = document.createElement('iframe');
                iframe.srcdoc = content;
                iframe.style.cssText = `
                    width: 100%;
                    height: 600px;
                    border: none;
                    border-radius: 10px;
                `;
                
                iframeContainer.appendChild(iframe);
                
                // Toggle functionality
                toggleButton.addEventListener('click', () => {
                    const isHidden = iframeContainer.style.display === 'none';
                    iframeContainer.style.display = isHidden ? 'block' : 'none';
                    toggleButton.querySelector('span').textContent = isHidden ? '‚ñ≤' : '‚ñº';
                    toggleButton.style.marginBottom = isHidden ? '10px' : '0';
                    
                    // Resize iframe when shown
                    if (isHidden) {
                        setTimeout(() => {
                            iframe.style.height = iframe.contentWindow.document.body.scrollHeight + 'px';
                        }, 100);
                    }
                });
                
                const timeDiv = document.createElement('div');
                timeDiv.className = 'message-time';
                timeDiv.textContent = formatTime();
                
                messageDiv.appendChild(toggleButton);
                messageDiv.appendChild(iframeContainer);
                messageDiv.appendChild(timeDiv);
            } else {
                // Regular text content
                messageDiv.innerHTML = `
                    <div class="message-content">${content}</div>
                    <div class="message-time">${formatTime()}</div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            scrollToBottom();
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        function handleEnter(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function sendQuickPrompt(prompt) {
            userInput.value = prompt;
            autoResize(userInput);
            sendMessage();
        }

        async function sendMessage() {
            const message = userInput.value.trim();
            
            if (!message) return;

            // Add user message
            addMessage(message, true);
            userInput.value = '';
            autoResize(userInput);
            
            // Disable input and show loading
            userInput.disabled = true;
            sendButton.disabled = true;
            buttonText.textContent = 'Sending...';
            buttonIcon.textContent = '‚è≥';

            try {
                // Send to webhook
                const response = await fetch(`${WEBHOOK_URL}?query=${message}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.text();
                
                // Add bot response
                addMessage(JSON.parse(data)["content"], false);

            } catch (error) {
                console.error('Error:', error);
                addMessage(`‚ùå Error sending message to webhook: ${error.message}<br><br>Please ensure your n8n server is running at:<br><code>${WEBHOOK_URL}</code>`, false);
            } finally {
                // Re-enable input
                userInput.disabled = false;
                sendButton.disabled = false;
                buttonText.textContent = 'Send';
                buttonIcon.textContent = 'üöÄ';
                userInput.focus();
            }
        }

        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Initialize
        userInput.focus();
        
        // Auto-resize on load
        window.addEventListener('load', () => {
            autoResize(userInput);
        });
    </script>
</body>
</html>