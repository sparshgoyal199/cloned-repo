{
  "name": "AI-Executive-Assistant v4 - Merge Workflow",
  "nodes": [
    {
      "parameters": {
        "operation": "getAll",
        "returnAll": true,
        "simple": false,
        "filters": {
          "q": "={{ \n (() => {\n const yesterday = new Date();\n yesterday.setDate(yesterday.getDate() - 1);\n return `after:${yesterday.getFullYear()}/${(yesterday.getMonth() + 1).toString().padStart(2, '0')}/${yesterday.getDate().toString().padStart(2, '0')}`;\n })()\n}}"
        },
        "options": {}
      },
      "id": "3fa7763a-2e48-4c0c-87ae-9daeb61131b0",
      "name": "Fetch Emails - Past 24 Hours",
      "type": "n8n-nodes-base.gmail",
      "position": [
        3408,
        432
      ],
      "webhookId": "fc4143cf-c3c6-4be6-b1b6-9f2de8e8ee16",
      "typeVersion": 2.1,
      "executeOnce": true,
      "credentials": {
        "gmailOAuth2": {
          "id": "hz9dBCQo0ot60lCE",
          "name": "Gmail account 2"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.data }}",
        "options": {
          "systemMessage": "=You are an AI executive assistant specialized in processing emails for a high-level CTO of a technology company. Your task is to analyze ALL emails and categorize them with detailed priority levels for daily digest.\n\n## CTO CONTEXT:\n- Role: Chief Technology Officer overseeing product development, engineering teams, technology strategy, and AI/ML initiatives\n- Company: Tech company with focus on AI solutions (Flexilytics AI in this case)\n- Reports to: CEO/Board\n- Manages: Engineering teams, Product development, Technical architecture, AI/ML teams\n- Key responsibilities: Technology strategy, Product roadmaps, Technical hiring, Budget oversight, Vendor decisions, Security/Compliance\n\n## INCLUSION PHILOSOPHY:\nInclude ALL emails but categorize them appropriately. Even low-priority emails should be included in the digest so the CTO has complete visibility.\n\n## PRIORITY LEVEL SYSTEM (7 Levels with Clear Behavioral Triggers):\n\n### **1ï¸âƒ£ CRITICAL ðŸš¨ - IMMEDIATE ACTION REQUIRED**\n**Definition:** Anything that can stop the company, damage trust, or escalate to the board if not acted on immediately.\n**Triggers:**\n- Production outage / security breach\n- Major customer escalation\n- Legal / compliance risk\n- Board or CEO escalation\n- Missed go-live / SLA breach happening now\n**Examples:** \"Production down for payments in EU region\", \"Security vulnerability exploited in core system\", \"CEO needs approval in 2 hours\"\n**CTO Behavior:** Drops everything, acts immediately\n\n### **2ï¸âƒ£ URGENT ðŸ”¥ - TIME-BOUND DECISIONS**\n**Definition:** Important issues with a hard deadline that will block teams if ignored.\n**Triggers:**\n- Budget approvals with deadline\n- Vendor renewal expiring\n- Hiring approval blocking onboarding\n- Customer escalation with deadline\n**Examples:** \"Need approval by EOD to release funds\", \"Vendor contract expires tomorrow\", \"Hiring decision needed before offer expires\"\n**CTO Behavior:** Scheduled action today, delegates with follow-up\n\n### **3ï¸âƒ£ HIGH âš¡ - HIGH BUSINESS IMPACT, NOT ON FIRE**\n**Definition:** Strategic or execution-critical topics that shape outcomes, but don't explode today.\n**Triggers:**\n- Architecture decisions\n- Roadmap changes\n- Platform scalability discussions\n- Key partner or enterprise customer discussions\n**Examples:** \"Proposed architecture change for next quarter\", \"Customer asking for roadmap commitment\", \"Engineering velocity concerns\"\n**CTO Behavior:** Reviews carefully, plans discussion\n\n### **4ï¸âƒ£ MEDIUM ðŸ“Œ - IMPORTANT AWARENESS, NO IMMEDIATE ACTION**\n**Definition:** Matters worth knowing but not blocking execution.\n**Triggers:**\n- Status updates\n- Weekly summaries\n- FYI leadership updates\n- Non-blocking risks\n**Examples:** \"Weekly engineering metrics\", \"Sprint retrospective summary\", \"FYI on infra optimization\"\n**CTO Behavior:** Skims, uses for context\n\n### **5ï¸âƒ£ LOW ðŸ§¾ - NICE TO KNOW, LOW IMPACT**\n**Definition:** Useful information with minimal influence on decisions.\n**Triggers:**\n- General updates\n- Non-critical vendor info\n- Internal announcements\n**Examples:** \"Tool upgrade announcement\", \"Team event update\", \"Minor policy changes\"\n**CTO Behavior:** Reads if time permits\n\n### **6ï¸âƒ£ INFORMATIONAL ðŸ“¬ - NO ACTION, PURE NOISE FOR CTO**\n**Definition:** Emails that should not consume CTO attention.\n**Triggers:**\n- Newsletters\n- Automated alerts\n- Generic HR or IT broadcasts\n- Sales cold emails\n**Examples:** \"Monthly product newsletter\", \"You have been added to Jira\", \"Introducing our AI solution\"\n**CTO Behavior:** Should never see these\n\n### **7ï¸âƒ£ PERSONAL ðŸ‘¤ - HUMAN, NON-WORK EMAILS**\n**Definition:** Emails not related to company operations.\n**Triggers:**\n- Personal messages\n- Social invitations\n- External non-work conversations\n**Examples:** \"Catching up this weekend?\", \"Happy Birthday\", \"Personal travel info\"\n**CTO Behavior:** Read privately, not in work digest\n\n## CATEGORIES (For Better Organization):\n- \"Strategic Planning\" - Company/department strategy\n- \"Resource Management\" - Budget, hiring, allocations\n- \"Project Management\" - Project updates, deadlines\n- \"Technical Decision\" - Architecture, tech stack, security\n- \"Vendor/Partnership\" - Vendors, partnerships, contracts\n- \"Compliance/Security\" - Security, compliance, legal\n- \"Executive Communication\" - CEO/Board/C-level\n- \"Team Management\" - Team updates, 1:1s, HR matters\n- \"Client/Stakeholder\" - Client communications, escalations\n- \"Industry/News\" - Newsletters, industry updates\n- \"Personal/Admin\" - Personal, admin, logistics\n- \"Meeting/Event\" - Meeting invites, event coordination\n\n## OUTPUT FORMAT (STRICT JSON for ALL emails):\n```json\n{\n  \"summary\": \"2-3 sentence concise summary. For low-priority: 'TechCrunch newsletter covering latest AI developments. No action required.'\",\n  \"urgency\": \"CRITICAL/URGENT/HIGH/MEDIUM/LOW/INFORMATIONAL/PERSONAL\",\n  \"category\": \"One of the categories above\",\n  \"action_items\": [\n    {\n      \"action\": \"Specific action if any, else 'No action required'\",\n      \"deadline\": \"YYYY-MM-DD or 'None' or timeframe\",\n      \"owner\": \"CTO/Team/System/Auto\",\n      \"priority\": \"High/Medium/Low/None\"\n    }\n  ],\n  \"created_at\": \"Current timestamp in ISO format: YYYY-MM-DDTHH:MM:SSZ\",\n  \"message_id_url\": \"Email identifier\"\n}\nEMAIL CLASSIFICATION EXAMPLES:\nEmail 1: \"PRODUCTION DOWN: Client X System Outage\"\n\njson\n{\n  \"summary\": \"Production system outage reported for Client X. Engineering team investigating root cause. Customer support receiving multiple complaints.\",\n  \"urgency\": \"CRITICAL\",\n  \"category\": \"Compliance/Security\",\n  \"action_items\": [\n    {\n      \"action\": \"Join emergency bridge call with engineering\",\n      \"deadline\": \"Today 11:00 AM\",\n      \"owner\": \"CTO\",\n      \"priority\": \"High\"\n    }\n  ],\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"message_id_url\": \"emergency_001@thread.id\"\n}\nEmail 2: \"TechCrunch AI Newsletter\"\n\njson\n{\n  \"summary\": \"Weekly TechCrunch newsletter covering latest AI funding rounds and product launches. Includes analysis of competitor movements.\",\n  \"urgency\": \"INFORMATIONAL\",\n  \"category\": \"Industry/News\",\n  \"action_items\": [\n    {\n      \"action\": \"No action required\",\n      \"deadline\": \"None\",\n      \"owner\": \"None\",\n      \"priority\": \"None\"\n    }\n  ],\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"message_id_url\": \"newsletter_002@thread.id\"\n}\nEmail 3: \"Team Lunch Invitation - Friday\"\n\njson\n{\n  \"summary\": \"Engineering team lunch invitation for Friday at 1 PM. RSVP requested by Thursday.\",\n  \"urgency\": \"LOW\",\n  \"category\": \"Team Management\",\n  \"action_items\": [\n    {\n      \"action\": \"RSVP for team lunch\",\n      \"deadline\": \"2024-01-18\",\n      \"owner\": \"CTO\",\n      \"priority\": \"Low\"\n    }\n  ],\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"message_id_url\": \"social_003@thread.id\"\n}\nEmail 4: \"LinkedIn: Connection Request from Jane Doe\"\n\njson\n{\n  \"summary\": \"LinkedIn connection request from Jane Doe, Head of AI at Competitor Inc. Optional connection.\",\n  \"urgency\": \"PERSONAL\",\n  \"category\": \"Personal/Admin\",\n  \"action_items\": [\n    {\n      \"action\": \"Review connection request\",\n      \"deadline\": \"None\",\n      \"owner\": \"CTO\",\n      \"priority\": \"None\"\n    }\n  ],\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"message_id_url\": \"linkedin_004@thread.id\"\n}\nEmail 5: \"Q3 Budget Approval Required by Friday\"\n\njson\n{\n  \"summary\": \"Q3 engineering budget requires CTO approval by Friday. Includes new headcount requests and infrastructure upgrades.\",\n  \"urgency\": \"URGENT\",\n  \"category\": \"Resource Management\",\n  \"action_items\": [\n    {\n      \"action\": \"Review and approve Q3 budget\",\n      \"deadline\": \"2024-01-19\",\n      \"owner\": \"CTO\",\n      \"priority\": \"High\"\n    }\n  ],\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"message_id_url\": \"budget_005@thread.id\"\n}\nEmail 6: \"Weekly Engineering Metrics Report\"\n\njson\n{\n  \"summary\": \"Weekly engineering metrics show velocity improved by 15% but bug count increased by 10%. Deployment frequency remains stable.\",\n  \"urgency\": \"MEDIUM\",\n  \"category\": \"Team Management\",\n  \"action_items\": [\n    {\n      \"action\": \"Discuss bug increase with engineering leads\",\n      \"deadline\": \"2024-01-22\",\n      \"owner\": \"CTO\",\n      \"priority\": \"Medium\"\n    }\n  ],\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"message_id_url\": \"metrics_006@thread.id\"\n}\nPROCESSING RULES:\nINCLUDE ALL EMAILS - Process every single email, no filtering\n\nAssign urgency based on the 7-level system - Use exact urgency labels: CRITICAL, URGENT, HIGH, MEDIUM, LOW, INFORMATIONAL, PERSONAL\n\nCreate meaningful summaries - Even for low-priority emails\n\nAction items should reflect urgency - CRITICAL/URGENT get specific actions with deadlines\n\nUse current timestamp for created_at in ISO format\n\nCategory selection should be accurate for easy filtering\n\nFor newsletters/news - Summarize 2-3 key topics covered\n\nFor meeting invites - Note date, time, required preparation\n\nFor personal emails - Keep summary professional\n\nSPECIAL INSTRUCTIONS:\nNewsletters: Summarize 2-3 key topics mentioned\n\nMeeting invites: Note date, time, required preparation\n\nAutomated alerts: Note if any require follow-up\n\nPersonal emails: Keep summary professional\n\nMultiple similar emails: Group conceptually in summary\n\nAttachments: Note if important documents are attached\n\nDO NOT include \"priority\" field - Only use \"urgency\" field with the 7 defined levels\n\nFINAL OUTPUT REQUIREMENT:\nOutput ONLY valid JSON array with one object per email. Each object MUST contain exactly these fields:\n\nsummary\n\nurgency\n\ncategory\n\naction_items\n\ncreated_at\n\nmessage_id_url\n\nExample:\n\njson\n[\n  {\n    \"summary\": \"...\",\n    \"urgency\": \"CRITICAL\",\n    \"category\": \"Compliance/Security\",\n    \"action_items\": [...],\n    \"created_at\": \"2024-01-15T10:30:00Z\",\n    \"message_id_url\": \"email_001@thread.id\"\n  }\n]\nNo additional text, explanations, or markdown outside the JSON structure."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        3872,
        768
      ],
      "id": "ead71014-deec-426d-a0f5-ef7b820f2217",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3440,
        768
      ],
      "id": "1b29f64f-d857-4bd1-a896-5e99430bf8f4",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "jsCode": "// Get raw LLM output text\nconst rawText = $input.first().json.output;\n\nlet items = [];\n\ntry {\n  // Clean the text first - remove ```json and ```\n  let cleanText = rawText.trim();\n  \n  // Remove markdown code blocks\n  if (cleanText.startsWith('```json')) {\n    cleanText = cleanText.replace(/^```json\\s*/, '').replace(/\\s*```$/, '');\n  } else if (cleanText.startsWith('```')) {\n    cleanText = cleanText.replace(/^```\\s*/, '').replace(/\\s*```$/, '');\n  }\n  \n  // Fix the JSON syntax errors - remove extra closing brackets and commas\n  // The issue is there are ]}, where it should be },\n  cleanText = cleanText.replace(/\\]\\s*,\\s*\\{/g, '},{');\n  \n  // Also handle any trailing commas before closing bracket\n  cleanText = cleanText.replace(/,\\s*\\]/g, ']');\n  \n  // Parse the cleaned JSON\n  const parsed = JSON.parse(cleanText);\n  \n  if (Array.isArray(parsed)) {\n    items = parsed\n      .filter(item => item !== null)\n      .map(item => ({ json: item }));\n  } else if (parsed !== null) {\n    items = [{ json: parsed }];\n  }\n  \n} catch (parseError) {\n  console.log(`Initial parse failed: ${parseError.message}`);\n  \n  // Try a more aggressive cleanup\n  try {\n    // Extract just the array content\n    const arrayMatch = rawText.match(/\\[\\s*(\\{[\\s\\S]*\\})\\s*\\]/);\n    \n    if (arrayMatch) {\n      let arrayContent = arrayMatch[1];\n      \n      // Fix the specific syntax errors in your JSON\n      // Replace \"], {\" with just \",{\"\n      arrayContent = arrayContent.replace(/\\]\\s*,\\s*\\{/g, ',{');\n      \n      // Wrap it back in array brackets\n      const fixedJson = '[' + arrayContent + ']';\n      \n      const parsed = JSON.parse(fixedJson);\n      \n      if (Array.isArray(parsed)) {\n        items = parsed\n          .filter(item => item !== null)\n          .map(item => ({ json: item }));\n      }\n    }\n  } catch (secondError) {\n    console.log(`Second attempt also failed: ${secondError.message}`);\n    \n    // Last resort: try to extract individual objects\n    const objectMatches = rawText.match(/\\{[^{}]*\\}/g);\n    \n    if (objectMatches) {\n      for (const match of objectMatches) {\n        try {\n          const obj = JSON.parse(match);\n          if (obj && typeof obj === 'object' && obj.id) {\n            items.push({ json: obj });\n          }\n        } catch (e) {\n          // Skip invalid objects\n          continue;\n        }\n      }\n    }\n  }\n}\n\n// Return the items in n8n format\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4224,
        768
      ],
      "id": "609eb34f-e108-4604-a697-eb4b0b1b1f16",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "content": "Workflow 1 - Retreiving and storing data into database",
        "height": 256,
        "width": 1648
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3024,
        368
      ],
      "typeVersion": 1,
      "id": "ca6c0243-2391-4dd9-8855-4847072fd59a",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2fe8d01e-48da-4501-9884-78c12ca67341",
              "name": "url",
              "value": "=https://mail.google.com/mail/u/0/#search/rfc822msgid:{{$json.messageId}}",
              "type": "string"
            },
            {
              "id": "67d15cc8-178a-47f7-8efe-f76aad296dfb",
              "name": "labelIds",
              "value": "={{ $json.labelIds }}",
              "type": "array"
            },
            {
              "id": "8bd7878b-f4f9-4135-b4c5-fd2df35de423",
              "name": "text",
              "value": "={{ $json.text }}",
              "type": "string"
            },
            {
              "id": "85bf5829-ae0f-40e3-8a12-0257064643ff",
              "name": "subject",
              "value": "={{ $json.subject }}",
              "type": "string"
            },
            {
              "id": "b09a6df5-cf82-4edb-81db-75215a82c349",
              "name": "from",
              "value": "={{ $json.from }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3600,
        432
      ],
      "id": "8fd5a901-f6f6-45e6-8658-5f980612d60c",
      "name": "Edit Fields",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f5e909ed-b57f-4b50-b2dd-091d536ec7ad",
              "name": "id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "f29ee1bd-4991-41fe-b462-f0e16b46a6e3",
              "name": "summary",
              "value": "={{ $json.summary }}",
              "type": "string"
            },
            {
              "id": "2e639176-1771-43f8-90d7-6bee917458cb",
              "name": "start.dateTime",
              "value": "={{ $json.start.dateTime }}",
              "type": "string"
            },
            {
              "id": "6777a0e7-9a94-4f9b-be41-072a20a1360e",
              "name": "end.dateTime",
              "value": "={{ $json.end.dateTime }}",
              "type": "string"
            },
            {
              "id": "c566936d-0477-4ab6-bf0d-37b2c9263d1b",
              "name": "created",
              "value": "={{ $json.created }}",
              "type": "string"
            },
            {
              "id": "56f0c659-2c59-45a7-b3ec-c0a6a4e00759",
              "name": "description",
              "value": "={{ $json.description || null}}",
              "type": "string"
            },
            {
              "id": "b1b4937d-1ee9-4dca-8257-41611ec65fc0",
              "name": "htmlLink",
              "value": "={{ $json.htmlLink }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4432,
        432
      ],
      "id": "82085952-c7da-4125-bf5e-4013ff3dfde2",
      "name": "Edit Fields1",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.data }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=You are an AI assistant creating a structured morning digest for a CTO. Based on processed emails and calendar meetings, generate ONLY a JSON object with the following structure:\n\n## INPUT DATA:\n- Processed emails with fields: summary, urgency, category, action_items, created_at, message_id_url\n- Calendar meetings for next 7 days with: start_time, end_time, title, description, location, attendees, html_link\n\n## OUTPUT FORMAT (STRICT JSON ONLY - NO OTHER TEXT):\n\n```json\n{\n  \"header\": {\n    \"morning_digest\": \"MORNING DIGEST - [Current Date in Month DD, YYYY format]\",\n    \"generated\": \"[Current Time in HH:MM AM/PM format]\",\n    \"yesterdays_emails\": [Total count of processed emails],\n    \"upcoming_meetings\": [Total count of meetings in next 7 days]\n  },\n  \n  \"immediate_attention_required\": {\n    \"critical_emails\": [\n      {\n        \"message\": \"One-line summary of CRITICAL email 1\",\n        \"link\": \"message_id_url from email 1\"\n      },\n      {\n        \"message\": \"One-line summary of CRITICAL email 2\",\n        \"link\": \"message_id_url from email 2\"\n      }\n    ],\n    \"critical_meetings_today\": [\n      {\n        \"message\": \"One-line summary of today's critical meeting 1\",\n        \"link\": \"html_link from meeting 1\"\n      },\n      {\n        \"message\": \"One-line summary of today's critical meeting 2\",\n        \"link\": \"html_link from meeting 2\"\n      }\n    ]\n  },\n  \n  \"action_required_from_mails\": [\n    {\n      \"message\": \"Action item 1 from CRITICAL/URGENT/HIGH emails\",\n      \"deadline\": \"Corresponding deadline for action 1\",\n      \"link\": \"message_id_url from corresponding email\"\n    },\n    {\n      \"message\": \"Action item 2 from CRITICAL/URGENT/HIGH emails\",\n      \"deadline\": \"Corresponding deadline for action 2\",\n      \"link\": \"message_id_url from corresponding email\"\n    }\n  ],\n  \n  \"action_required_before_meetings\": [\n    {\n      \"message\": \"Preparation action for meeting 1\",\n      \"deadline\": \"Meeting start time (format as Today HH:MM or Date)\",\n      \"link\": \"html_link from meeting 1\"\n    },\n    {\n      \"message\": \"Preparation action for meeting 2\",\n      \"deadline\": \"Meeting start time (format as Today HH:MM or Date)\",\n      \"link\": \"html_link from meeting 2\"\n    }\n  ],\n  \n  \"email_digest\": {\n    \"critical\": [\n      {\n        \"summary\": \"2-3 line summary of CRITICAL email 1\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 1\"\n      },\n      {\n        \"summary\": \"2-3 line summary of CRITICAL email 2\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 2\"\n      }\n    ],\n    \"urgent\": [\n      {\n        \"summary\": \"2-3 line summary of URGENT email 1\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 1\"\n      },\n      {\n        \"summary\": \"2-3 line summary of URGENT email 2\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 2\"\n      }\n    ],\n    \"high\": [\n      {\n        \"summary\": \"2-3 line summary of HIGH email 1\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 1\"\n      },\n      {\n        \"summary\": \"2-3 line summary of HIGH email 2\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 2\"\n      }\n    ],\n    \"medium\": [\n      {\n        \"summary\": \"2-3 line summary of MEDIUM email 1\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 1\"\n      },\n      {\n        \"summary\": \"2-3 line summary of MEDIUM email 2\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 2\"\n      }\n    ]\n  },\n  \n  \"todays_meetings\": [\n    {\n      \"time\": \"Start-End time (e.g., 10:00-10:30)\",\n      \"summary\": \"Meeting title and one-line purpose\",\n      \"location\": \"Meeting location/virtual link\",\n      \"link\": \"html_link from meeting\"\n    }\n  ],\n  \n  \"awareness_items\": [\n    {\n      \"type\": \"LOW\",\n      \"summary\": \"One-line summary of LOW urgency email\",\n      \"link\": \"message_id_url from email\"\n    },\n    {\n      \"type\": \"INFORMATIONAL\",\n      \"summary\": \"One-line summary of INFORMATIONAL email\",\n      \"link\": \"message_id_url from email\"\n    },\n    {\n      \"type\": \"PERSONAL\",\n      \"summary\": \"One-line summary of PERSONAL email\",\n      \"link\": \"message_id_url from email\"\n    }\n  ]\n}\nPROCESSING RULES:\n1. HEADER:\nUse current date and time (e.g., \"January 16, 2024\", \"8:00 AM\")\n\nCount total emails processed (all urgency levels)\n\nCount total meetings in next 7 days\n\n2. IMMEDIATE ATTENTION REQUIRED:\ncritical_emails: Include ONLY emails with urgency = \"CRITICAL\"\n\nFormat: Extract concise one-line summary from email's summary field\n\nInclude ALL CRITICAL emails, no limit\n\nInclude link: Use the message_id_url from the email as the \"link\" value\n\ncritical_meetings_today: Include today's meetings that are absolutely mandatory\n\nKeywords in title/description: \"urgent\", \"critical\", \"emergency\", \"immediate\", \"ASAP\", \"today\", \"blocking\", \"crisis\", \"fire drill\", \"red alert\", \"priority 1\", \"P0\", \"P1\"\n\nOr meetings where CTO is the main presenter/decision maker\n\nInclude link: Use the html_link from the meeting as the \"link\" value\n\n3. ACTION REQUIRED FROM MAILS:\nInclude emails with urgency = \"CRITICAL\", \"URGENT\", or \"HIGH\"\n\nExtract ALL action items from action_items array for each email\n\nEach action item becomes a separate object in the array\n\nFormat: Simple, actionable phrases for \"message\"\n\nInclude corresponding deadline for each action as \"deadline\"\n\nInclude link: Use the message_id_url from the corresponding email as the \"link\" value\n\n4. ACTION REQUIRED BEFORE MEETINGS:\nConsider ALL meetings in next 7 days\n\nExtract preparation actions from meeting descriptions\n\nIf no explicit preparation mentioned, infer based on meeting type:\n\nBoard/executive meetings â†’ \"Prepare slides/updates\"\n\nClient meetings â†’ \"Review account details\"\n\nTechnical reviews â†’ \"Review documents/code\"\n\nTeam meetings â†’ \"Review agenda/updates\"\n\nDeadline = meeting start time (format as \"Today HH:MM\" or \"Date HH:MM\")\n\nInclude link: Use the html_link from the meeting as the \"link\" value\n\n5. EMAIL DIGEST - CRITICAL REQUIREMENT: INCLUDE EVERY EMAIL\nMUST INCLUDE EVERY SINGLE EMAIL in these categories:\n\ncritical: ALL emails with urgency = \"CRITICAL\"\n\nExtract summary from email's summary field (2-3 lines)\n\nExtract action from action_items[0].action (or \"No action\" if empty)\n\nExtract deadline from action_items[0].deadline (or \"None\" if empty)\n\nInclude link: message_id_url from the email\n\nurgent: ALL emails with urgency = \"URGENT\"\n\nExtract summary from email's summary field (2-3 lines)\n\nExtract action from action_items[0].action (or \"No action\" if empty)\n\nExtract deadline from action_items[0].deadline (or \"None\" if empty)\n\nInclude link: message_id_url from the email\n\nhigh: ALL emails with urgency = \"HIGH\"\n\nExtract summary from email's summary field (2-3 lines)\n\nExtract action from action_items[0].action (or \"No action\" if empty)\n\nExtract deadline from action_items[0].deadline (or \"None\" if empty)\n\nInclude link: message_id_url from the email\n\nmedium: ALL emails with urgency = \"MEDIUM\"\n\nExtract summary from email's summary field (2-3 lines)\n\nExtract action from action_items[0].action (or \"No action\" if empty)\n\nExtract deadline from action_items[0].deadline (or \"None\" if empty)\n\nInclude link: message_id_url from the email\n\nVERIFICATION CHECK:\n\nTotal emails in email_digest = yesterdays_emails count - (LOW + INFORMATIONAL + PERSONAL emails)\n\n6. TODAY'S MEETINGS:\nInclude ONLY today's meetings\n\nFormat time as \"HH:MM-HH:MM\" (24-hour format)\n\nSummary: \"[Meeting title]: [Brief 5-7 word purpose]\"\n\nLocation: Physical location or \"Google Meet\"/\"Zoom\"/\"Teams\"\n\nInclude link: html_link from the meeting\n\nSort chronologically\n\n7. AWARENESS ITEMS:\nInclude ALL emails with urgency = \"LOW\", \"INFORMATIONAL\", or \"PERSONAL\"\n\nFormat: One-line summary only\n\nInclude type for filtering\n\nInclude link: message_id_url from the email\n\nGroup similar items when possible\n\nDATA MAPPING EXAMPLES:\nInput Email Example:\n\njson\n{\n  \"summary\": \"Production database outage affecting Client X. Team investigating root cause. Requires CTO escalation within 2 hours.\",\n  \"urgency\": \"CRITICAL\",\n  \"category\": \"Compliance/Security\",\n  \"action_items\": [\n    {\n      \"action\": \"Join emergency bridge call with engineering team\",\n      \"deadline\": \"Today 11:00 AM\",\n      \"owner\": \"CTO\",\n      \"priority\": \"High\"\n    }\n  ],\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"message_id_url\": \"https://mail.google.com/mail/u/0/#inbox/email_001\"\n}\nInput Meeting Example:\n\njson\n{\n  \"start_time\": \"2024-01-16T10:00:00\",\n  \"end_time\": \"2024-01-16T10:30:00\",\n  \"title\": \"Emergency Production Review\",\n  \"description\": \"URGENT: Review production outage with engineering team. Bring incident report and timeline.\",\n  \"location\": \"War Room 3\",\n  \"attendees\": [\"CTO\", \"Head of Engineering\", \"DevOps Lead\"],\n  \"html_link\": \"https://calendar.google.com/calendar/event?eid=abc123\"\n}\nCorresponding Output Mappings:\n\nFor Immediate Attention Required:\n\njson\n\"critical_emails\": [\n  {\n    \"message\": \"Production database outage affecting Client X - requires CTO escalation within 2 hours\",\n    \"link\": \"https://mail.google.com/mail/u/0/#inbox/email_001\"\n  }\n],\n\"critical_meetings_today\": [\n  {\n    \"message\": \"Emergency production review at 10:00 AM in War Room 3\",\n    \"link\": \"https://calendar.google.com/calendar/event?eid=abc123\"\n  }\n]\nFor Action Required from Mails:\n\njson\n\"action_required_from_mails\": [\n  {\n    \"message\": \"Join emergency bridge call with engineering team\",\n    \"deadline\": \"Today 11:00 AM\",\n    \"link\": \"https://mail.google.com/mail/u/0/#inbox/email_001\"\n  }\n]\nFor Action Required Before Meetings:\n\njson\n\"action_required_before_meetings\": [\n  {\n    \"message\": \"Review incident report and timeline for Emergency Production Review\",\n    \"deadline\": \"Today 10:00 AM\",\n    \"link\": \"https://calendar.google.com/calendar/event?eid=abc123\"\n  }\n]\nFor Email Digest (CRITICAL section):\n\njson\n\"critical\": [\n  {\n    \"summary\": \"Production database outage affecting Client X. Team investigating root cause. Requires CTO escalation within 2 hours.\",\n    \"action\": \"Join emergency bridge call with engineering team\",\n    \"deadline\": \"Today 11:00 AM\",\n    \"link\": \"https://mail.google.com/mail/u/0/#inbox/email_001\"\n  }\n]\nFor Today's Meetings:\n\njson\n{\n  \"time\": \"10:00-10:30\",\n  \"summary\": \"Emergency Production Review: Review production outage with engineering team\",\n  \"location\": \"War Room 3\",\n  \"link\": \"https://calendar.google.com/calendar/event?eid=abc123\"\n}\nFor Awareness Items:\n\njson\n{\n  \"type\": \"INFORMATIONAL\",\n  \"summary\": \"TechCrunch newsletter covering AI funding trends\",\n  \"link\": \"https://mail.google.com/mail/u/0/#inbox/newsletter_001\"\n}\nCOMPREHENSIVE INCLUSION GUARANTEE:\nTo ensure ALL emails are included in email_digest, follow this algorithm:\n\nCollect all input emails into arrays by urgency:\n\ncritical_emails = emails where urgency = \"CRITICAL\"\n\nurgent_emails = emails where urgency = \"URGENT\"\n\nhigh_emails = emails where urgency = \"HIGH\"\n\nmedium_emails = emails where urgency = \"MEDIUM\"\n\nother_emails = emails where urgency in [\"LOW\", \"INFORMATIONAL\", \"PERSONAL\"]\n\nFor each urgency category, process EVERY email:\n\nInclude in the corresponding email_digest section\n\nUse the exact summary from input\n\nExtract action and deadline from action_items[0]\n\nInclude message_id_url as link\n\nCount verification:\n\ntotal_emails_in_digest = len(critical) + len(urgent) + len(high) + len(medium)\n\ntotal_other_emails = len(other_emails)\n\ntotal_all_emails = total_emails_in_digest + total_other_emails\n\nThis should match yesterdays_emails count\n\nFINAL VALIDATION CHECKLIST:\nâœ… Every input email appears in exactly one place:\n\nCRITICAL/URGENT/HIGH/MEDIUM â†’ email_digest\n\nLOW/INFORMATIONAL/PERSONAL â†’ awareness_items\n\nâœ… Every meeting appears in appropriate sections:\n\nToday's meetings â†’ todays_meetings\n\nAll meetings â†’ action_required_before_meetings if prep needed\n\nâœ… All email entries include message_id_url as \"link\"\nâœ… All meeting entries include html_link as \"link\"\nâœ… Arrays are not empty unless no items exist for that category\nâœ… JSON structure is exact as specified\nâœ… No missing fields in any object\n\nFINAL INSTRUCTION:\nGenerate ONLY the complete JSON object. Do not include any explanatory text, comments, or markdown outside the JSON structure. Ensure every single input email and meeting is accounted for in the output with proper links."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        4640,
        1216
      ],
      "id": "3837daab-85db-41cb-aef9-34bd2677afdc",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "all calendar meets",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3968,
        1216
      ],
      "id": "24b84bae-8a5b-4157-a806-750e1c2e3d1a",
      "name": "Aggregate1"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "summary of email",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3312,
        1216
      ],
      "id": "e979ed52-6737-497f-82a6-5595850f91de",
      "name": "Aggregate2",
      "executeOnce": false
    },
    {
      "parameters": {
        "jsCode": "return [{\"all calendar meets\":$input.first().json['all calendar meets']},{\"summary of email\":$('Aggregate2').first().json['summary of email']}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4192,
        1216
      ],
      "id": "c9c04825-456b-4a46-88e4-67960a5b5805",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4416,
        1216
      ],
      "id": "d9623ff2-3230-4282-9c6b-d1a69bde3d3f",
      "name": "Aggregate3"
    },
    {
      "parameters": {
        "jsCode": "// In a Code node after your LLM\nconst rawOutput = $input.first().json.output;\n\n// Clean the output\nlet cleanOutput = rawOutput.trim();\n\n// Remove markdown code blocks\nif (cleanOutput.startsWith('```json')) {\n  cleanOutput = cleanOutput.replace(/^```json\\s*/i, '').replace(/\\s*```$/, '');\n} else if (cleanOutput.startsWith('```')) {\n  cleanOutput = cleanOutput.replace(/^```\\s*/, '').replace(/\\s*```$/, '');\n}\n\n// Parse the JSON\ntry {\n  const parsed = JSON.parse(cleanOutput);\n  \n  // Return in n8n format\n  return [{\n    json: parsed\n  }];\n} catch (error) {\n  // Try to extract JSON if wrapped in other text\n  const jsonMatch = cleanOutput.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) {\n    try {\n      const parsed = JSON.parse(jsonMatch[0]);\n      return [{\n        json: parsed\n      }];\n    } catch (e) {\n      throw new Error(`Failed to parse JSON: ${e.message}`);\n    }\n  }\n  throw new Error(`No valid JSON found in output: ${cleanOutput.substring(0, 200)}...`);\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4992,
        1216
      ],
      "id": "0cd0589c-4c43-4679-a14a-54ec6e22a242",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "model": "ministral-3b-latest",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
      "typeVersion": 1,
      "position": [
        4608,
        1360
      ],
      "id": "b4e6fbaf-b26a-4342-acf8-8d53dad2eafb",
      "name": "Mistral Cloud Chat Model",
      "credentials": {
        "mistralCloudApi": {
          "id": "r1gnyzVtkR4gGLJD",
          "name": "Mistral Cloud account 2"
        }
      }
    },
    {
      "parameters": {
        "model": "ministral-3b-latest",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
      "typeVersion": 1,
      "position": [
        3584,
        928
      ],
      "id": "59389def-2e48-48ff-b853-7c826925a19a",
      "name": "Mistral Cloud Chat Model1",
      "credentials": {
        "mistralCloudApi": {
          "id": "r1gnyzVtkR4gGLJD",
          "name": "Mistral Cloud account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "emails_raw",
          "mode": "list",
          "cachedResultName": "emails_raw"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        3248,
        768
      ],
      "id": "c51fa429-19b8-4ab1-a6d6-2f01033e2909",
      "name": "Get emails",
      "executeOnce": true,
      "credentials": {
        "postgres": {
          "id": "vUQsA6wGLOxEwh8P",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "emails_ai",
          "mode": "list",
          "cachedResultName": "emails_ai"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        3088,
        1216
      ],
      "id": "81ca62cd-a05c-4c33-8d99-4ed9e24cc06f",
      "name": "get summary of the email",
      "executeOnce": true,
      "credentials": {
        "postgres": {
          "id": "vUQsA6wGLOxEwh8P",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "calendar_events",
          "mode": "list",
          "cachedResultName": "calendar_events"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        3536,
        1216
      ],
      "id": "7e5e565b-d65b-4caf-8170-4f6c6e49fc9d",
      "name": "get calendar events",
      "executeOnce": true,
      "credentials": {
        "postgres": {
          "id": "vUQsA6wGLOxEwh8P",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "emails_ai",
          "mode": "list",
          "cachedResultName": "emails_ai"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "summary": "={{ $json.summary }}",
            "urgency": "={{ $json.urgency }}",
            "category": "={{ $json.category }}",
            "action_items": "={{ $json.action_items[0] }}",
            "created_at": "={{ $now }}",
            "message_id_url": "={{ $json.html_link || null}}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "summary",
              "displayName": "summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "urgency",
              "displayName": "urgency",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "category",
              "displayName": "category",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "action_items",
              "displayName": "action_items",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "message_id_url",
              "displayName": "message_id_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        4448,
        768
      ],
      "id": "c918c397-68df-40db-966b-054d6fd30437",
      "name": "Insert summary of email in email ai table",
      "credentials": {
        "postgres": {
          "id": "vUQsA6wGLOxEwh8P",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "emails_raw",
          "mode": "list",
          "cachedResultName": "emails_raw"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "body": "={{ $json.text }}",
            "created_at": "={{ $now }}",
            "labels": "={{ $json.labelIds }}",
            "subject": "={{ $json.subject }}",
            "sender": "={{ $json.from.value }}",
            "message_id_url": "={{ $json.url }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "message_id_url",
              "displayName": "message_id_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "subject",
              "displayName": "subject",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "sender",
              "displayName": "sender",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            },
            {
              "id": "body",
              "displayName": "body",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "labels",
              "displayName": "labels",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        4032,
        432
      ],
      "id": "a84e79e6-8460-4dd0-b2ae-ad9316752ef4",
      "name": "Insert mail in a email table",
      "credentials": {
        "postgres": {
          "id": "vUQsA6wGLOxEwh8P",
          "name": "Postgres account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "calendar_events",
          "mode": "list",
          "cachedResultName": "calendar_events"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "event_id": "={{ $json.id }}",
            "start_time": "={{ $json.start.dateTime }}",
            "end_time": "={{ $json.end.dateTime }}",
            "created_at": "={{ $json.created }}",
            "title": "={{ $json.summary }}",
            "description": "={{ $json.description || null}}",
            "html_link": "={{ $json.htmlLink }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "event_id",
              "displayName": "event_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "description",
              "displayName": "description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "start_time",
              "displayName": "start_time",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "end_time",
              "displayName": "end_time",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "html_link",
              "displayName": "html_link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        4640,
        432
      ],
      "id": "890c4488-4bdc-43a9-ae8a-9bf63803cc26",
      "name": "Insert events in a calendar table",
      "credentials": {
        "postgres": {
          "id": "sgm1FkD3kU7pOVhf",
          "name": "Postgres account 2"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "daily_digest",
          "mode": "list",
          "cachedResultName": "daily_digest"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "digest_date": "={{ $now.toISODate() }}",
            "content": "={{ {object:$json.data} }}",
            "generated_at": "={{ $now }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "digest_date",
              "displayName": "digest_date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "content",
              "displayName": "content",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_at",
              "displayName": "generated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        5504,
        1200
      ],
      "id": "c6b8e3ca-ce32-4459-abaf-1972fdde15fd",
      "name": "Insert today digest in a daily digest table",
      "credentials": {
        "postgres": {
          "id": "vUQsA6wGLOxEwh8P",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "sparshgoyal199@gmail.com",
          "mode": "list",
          "cachedResultName": "sparshgoyal199@gmail.com"
        },
        "returnAll": true,
        "timeMax": "={{ $now.plus({ day: 1 }) }}",
        "options": {
          "orderBy": "startTime"
        }
      },
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.3,
      "position": [
        4224,
        432
      ],
      "id": "ecfb2169-66e2-4179-906c-1f9c245d362a",
      "name": "next day calendar events",
      "executeOnce": true,
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "F2XSJhlGSiX1UdSO",
          "name": "Google Calendar account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        5200,
        1216
      ],
      "id": "b08b3895-de50-4e27-bf6d-0031f39ca449",
      "name": "Aggregate4"
    },
    {
      "parameters": {
        "path": "6c9d4362-5268-47a8-b3f1-cb2340cfee27",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -256,
        1040
      ],
      "id": "7bb3ef3f-37b6-4bc8-84f1-bf9ddcd585d9",
      "name": "Webhook",
      "webhookId": "6c9d4362-5268-47a8-b3f1-cb2340cfee27"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tasks",
          "mode": "list",
          "cachedResultName": "tasks"
        },
        "returnAll": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        2112,
        1040
      ],
      "id": "774da619-02d6-47ab-9904-4d5c852703e7",
      "name": "Get Tasks",
      "credentials": {
        "postgres": {
          "id": "sgm1FkD3kU7pOVhf",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Code in JavaScript3').item.json.daily_digest }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "bc10aa56-2cec-4a03-b26f-b5612b7bee0d"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "6d277041-026e-4754-b35f-49ed7b86f0a6",
                    "leftValue": "={{ $('Code in JavaScript3').item.json.tasks }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f0925ad2-5cc3-4433-8441-1f02020f852b",
                    "leftValue": "={{ $('Code in JavaScript3').item.json.important_emails }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        1568,
        1040
      ],
      "id": "e35f3c89-dcc4-4e9a-b7ff-e8103d430ca7",
      "name": "Switch"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Aggregate5').item.json.data }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        2000,
        1280
      ],
      "id": "2f359c99-364e-4386-b971-69d17bb70ad7",
      "name": "AI Agent3"
    },
    {
      "parameters": {
        "model": "open-mistral-7b",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
      "typeVersion": 1,
      "position": [
        1952,
        1504
      ],
      "id": "237fc46e-e923-4f35-891f-89291a32c7dc",
      "name": "Mistral Cloud Chat Model3",
      "credentials": {
        "mistralCloudApi": {
          "id": "wMOucmZ3n2Z9wjB8",
          "name": "Mistral Cloud account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "3de1f4d5-7c07-4866-bea4-0a5e7ebfaf13",
              "leftValue": "={{ $json.html }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        2608,
        352
      ],
      "id": "38f6b6ee-ad66-4299-94e9-6f5395ed6115",
      "name": "If"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "daily_digest",
          "mode": "list",
          "cachedResultName": "daily_digest"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1776,
        352
      ],
      "id": "f626c102-633f-40c4-b74a-630517b5a573",
      "name": "Select rows from a table",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "vUQsA6wGLOxEwh8P",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <title>CTO Morning Digest Dashboard</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <style>\n        :root {\n            --primary-color: #2563eb;\n            --critical-color: #dc2626;\n            --urgent-color: #ea580c;\n            --high-color: #d97706;\n            --medium-color: #059669;\n            --low-color: #0891b2;\n            --informational-color: #6b7280;\n            --personal-color: #7c3aed;\n            --bg-light: #f8fafc;\n            --bg-white: #ffffff;\n            --border-color: #e2e8f0;\n            --text-primary: #1e293b;\n            --text-secondary: #64748b;\n            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);\n            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);\n            --radius: 8px;\n            --mobile-breakpoint: 768px;\n            --tablet-breakpoint: 1024px;\n            --desktop-breakpoint: 1200px;\n        }\n\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: 'Inter', sans-serif;\n            background-color: var(--bg-light);\n            color: var(--text-primary);\n            line-height: 1.6;\n            padding: clamp(10px, 2vw, 20px);\n            width: 100%;\n            min-height: 100vh;\n            -webkit-text-size-adjust: 100%;\n        }\n\n        .container {\n            display: grid;\n            grid-template-columns: 1fr;\n            gap: clamp(16px, 3vw, 24px);\n            width: 100%;\n            max-width: 1400px;\n            margin: 0 auto;\n        }\n\n        /* Header Section */\n        .header-section {\n            background: linear-gradient(135deg, var(--primary-color), #1d4ed8);\n            color: white;\n            padding: clamp(16px, 3vw, 24px);\n            border-radius: var(--radius);\n            box-shadow: var(--shadow-md);\n            display: flex;\n            flex-direction: column;\n            gap: clamp(12px, 2vw, 16px);\n            width: 100%;\n        }\n\n        .header-main {\n            width: 100%;\n        }\n\n        .header-main h1 {\n            font-size: clamp(1.25rem, 4vw, 1.75rem);\n            font-weight: 700;\n            margin-bottom: clamp(4px, 1vw, 8px);\n            line-height: 1.3;\n            word-break: break-word;\n        }\n\n        .header-subtitle {\n            font-size: clamp(0.875rem, 2vw, 1rem);\n            opacity: 0.9;\n            display: flex;\n            flex-wrap: wrap;\n            gap: clamp(8px, 2vw, 16px);\n            align-items: center;\n        }\n\n        .header-subtitle span {\n            display: flex;\n            align-items: center;\n            gap: 6px;\n            white-space: nowrap;\n        }\n\n        .header-stats {\n            display: flex;\n            flex-wrap: wrap;\n            gap: clamp(12px, 2vw, 24px);\n            width: 100%;\n            justify-content: center;\n        }\n\n        .stat-box {\n            background: rgba(255, 255, 255, 0.15);\n            padding: clamp(10px, 2vw, 12px) clamp(16px, 3vw, 20px);\n            border-radius: 6px;\n            text-align: center;\n            backdrop-filter: blur(10px);\n            min-width: 120px;\n            flex: 1;\n            max-width: 200px;\n        }\n\n        .stat-number {\n            font-size: clamp(1.25rem, 3vw, 1.5rem);\n            font-weight: 700;\n            display: block;\n            line-height: 1.2;\n        }\n\n        .stat-label {\n            font-size: clamp(0.75rem, 1.5vw, 0.875rem);\n            opacity: 0.9;\n            margin-top: 4px;\n        }\n\n        /* Alert Banner */\n        .alert-banner {\n            background: linear-gradient(135deg, var(--critical-color), #b91c1c);\n            color: white;\n            padding: clamp(12px, 2vw, 16px);\n            border-radius: var(--radius);\n            display: flex;\n            align-items: flex-start;\n            gap: clamp(8px, 1.5vw, 12px);\n            box-shadow: var(--shadow-md);\n            margin-bottom: clamp(4px, 1vw, 8px);\n            width: 100%;\n        }\n\n        .alert-icon {\n            font-size: clamp(1.25rem, 2.5vw, 1.5rem);\n            flex-shrink: 0;\n            margin-top: 2px;\n        }\n\n        .alert-content {\n            flex: 1;\n            min-width: 0;\n        }\n\n        .alert-title {\n            font-weight: 600;\n            margin-bottom: clamp(2px, 0.5vw, 4px);\n            font-size: clamp(0.875rem, 2vw, 1rem);\n        }\n\n        /* Cards */\n        .card {\n            background: var(--bg-white);\n            border-radius: var(--radius);\n            padding: clamp(16px, 3vw, 24px);\n            box-shadow: var(--shadow-sm);\n            transition: transform 0.2s, box-shadow 0.2s;\n            width: 100%;\n            overflow: hidden;\n        }\n\n        .card:hover {\n            transform: translateY(-2px);\n            box-shadow: var(--shadow-md);\n        }\n\n        @media (hover: none) {\n            .card:hover {\n                transform: none;\n                box-shadow: var(--shadow-sm);\n            }\n        }\n\n        .card-header {\n            display: flex;\n            flex-direction: column;\n            gap: clamp(8px, 1.5vw, 12px);\n            margin-bottom: clamp(12px, 2vw, 20px);\n            padding-bottom: clamp(8px, 1.5vw, 12px);\n            border-bottom: 2px solid var(--border-color);\n        }\n\n        .card-title {\n            font-size: clamp(1rem, 2.5vw, 1.25rem);\n            font-weight: 600;\n            color: var(--text-primary);\n            display: flex;\n            align-items: center;\n            gap: clamp(6px, 1vw, 8px);\n            flex-wrap: wrap;\n            width: 100%;\n        }\n\n        .badge {\n            padding: clamp(3px, 0.5vw, 4px) clamp(8px, 1.5vw, 10px);\n            border-radius: 20px;\n            font-size: clamp(0.625rem, 1.5vw, 0.75rem);\n            font-weight: 600;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n            white-space: nowrap;\n            flex-shrink: 0;\n        }\n\n        .badge-critical { background-color: var(--critical-color); color: white; }\n        .badge-urgent { background-color: var(--urgent-color); color: white; }\n        .badge-high { background-color: var(--high-color); color: white; }\n        .badge-medium { background-color: var(--medium-color); color: white; }\n        .badge-informational { background-color: var(--informational-color); color: white; }\n        .badge-personal { background-color: var(--personal-color); color: white; }\n        .badge-low { background-color: var(--low-color); color: white; }\n\n        /* Grid Layout */\n        .grid-2 {\n            display: grid;\n            grid-template-columns: 1fr;\n            gap: clamp(16px, 3vw, 24px);\n            width: 100%;\n        }\n\n        .grid-3 {\n            display: grid;\n            grid-template-columns: 1fr;\n            gap: clamp(16px, 3vw, 24px);\n            width: 100%;\n        }\n\n        /* List Items */\n        .list-item {\n            padding: clamp(12px, 2vw, 16px);\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            flex-direction: column;\n            gap: clamp(8px, 1.5vw, 12px);\n            width: 100%;\n        }\n\n        .list-item:last-child {\n            border-bottom: none;\n        }\n\n        .list-item-content {\n            width: 100%;\n            min-width: 0;\n        }\n\n        .list-item-title {\n            font-weight: 500;\n            margin-bottom: clamp(4px, 1vw, 6px);\n            display: flex;\n            align-items: flex-start;\n            gap: clamp(6px, 1vw, 8px);\n            flex-wrap: wrap;\n        }\n\n        .list-item-description {\n            color: var(--text-secondary);\n            font-size: clamp(0.75rem, 1.5vw, 0.875rem);\n            margin-bottom: clamp(6px, 1vw, 8px);\n            line-height: 1.5;\n            word-break: break-word;\n        }\n\n        .list-item-meta {\n            display: flex;\n            flex-wrap: wrap;\n            gap: clamp(8px, 1.5vw, 12px);\n            font-size: clamp(0.75rem, 1.5vw, 0.8125rem);\n            color: var(--text-secondary);\n            margin-top: 4px;\n        }\n\n        .list-item-action {\n            margin-top: clamp(4px, 1vw, 8px);\n            align-self: flex-start;\n        }\n\n        .action-btn {\n            background: var(--primary-color);\n            color: white;\n            border: none;\n            padding: clamp(5px, 1vw, 6px) clamp(10px, 2vw, 14px);\n            border-radius: 4px;\n            font-size: clamp(0.75rem, 1.5vw, 0.8125rem);\n            font-weight: 500;\n            cursor: pointer;\n            display: inline-flex;\n            align-items: center;\n            gap: clamp(4px, 0.5vw, 6px);\n            transition: background 0.2s;\n            text-decoration: none;\n            white-space: nowrap;\n        }\n\n        .action-btn:hover {\n            background: #1d4ed8;\n        }\n\n        @media (hover: none) {\n            .action-btn:hover {\n                background: var(--primary-color);\n            }\n        }\n\n        /* Email Digest Tabs */\n        .tabs {\n            display: flex;\n            overflow-x: auto;\n            border-bottom: 1px solid var(--border-color);\n            margin-bottom: clamp(12px, 2vw, 20px);\n            gap: 2px;\n            -webkit-overflow-scrolling: touch;\n            scrollbar-width: none;\n            padding-bottom: 2px;\n        }\n\n        .tabs::-webkit-scrollbar {\n            display: none;\n        }\n\n        .tab {\n            padding: clamp(10px, 2vw, 12px) clamp(12px, 2.5vw, 20px);\n            font-weight: 500;\n            cursor: pointer;\n            border-bottom: 3px solid transparent;\n            white-space: nowrap;\n            font-size: clamp(0.75rem, 1.5vw, 0.875rem);\n            flex-shrink: 0;\n        }\n\n        .tab.active {\n            border-bottom: 3px solid var(--primary-color);\n            color: var(--primary-color);\n        }\n\n        .tab-content {\n            display: none;\n            width: 100%;\n        }\n\n        .tab-content.active {\n            display: block;\n        }\n\n        /* Meeting Items */\n        .meeting-item {\n            display: flex;\n            flex-direction: column;\n            padding: clamp(12px, 2vw, 16px);\n            border-radius: 6px;\n            background: var(--bg-light);\n            margin-bottom: clamp(8px, 1.5vw, 12px);\n            gap: clamp(12px, 2vw, 16px);\n            width: 100%;\n        }\n\n        .meeting-time {\n            background: var(--primary-color);\n            color: white;\n            padding: clamp(6px, 1vw, 8px) clamp(8px, 1.5vw, 12px);\n            border-radius: 4px;\n            font-weight: 600;\n            text-align: center;\n            font-size: clamp(0.875rem, 2vw, 1rem);\n            align-self: flex-start;\n            min-width: 80px;\n        }\n\n        .meeting-details {\n            flex: 1;\n            min-width: 0;\n        }\n\n        .meeting-title {\n            font-weight: 500;\n            margin-bottom: clamp(2px, 0.5vw, 4px);\n            font-size: clamp(0.875rem, 2vw, 1rem);\n            line-height: 1.4;\n            word-break: break-word;\n        }\n\n        .meeting-location {\n            font-size: clamp(0.75rem, 1.5vw, 0.875rem);\n            color: var(--text-secondary);\n            display: flex;\n            align-items: center;\n            gap: 6px;\n        }\n\n        /* Empty States */\n        .empty-state {\n            text-align: center;\n            padding: clamp(20px, 4vw, 40px) clamp(10px, 2vw, 20px);\n            color: var(--text-secondary);\n            width: 100%;\n        }\n\n        .empty-state i {\n            font-size: clamp(2rem, 6vw, 3rem);\n            margin-bottom: clamp(12px, 2vw, 16px);\n            opacity: 0.5;\n        }\n\n        .empty-state p {\n            font-size: clamp(0.875rem, 2vw, 1rem);\n        }\n\n        /* Footer */\n        .footer {\n            text-align: center;\n            padding: clamp(16px, 2.5vw, 24px);\n            color: var(--text-secondary);\n            font-size: clamp(0.75rem, 1.5vw, 0.875rem);\n            margin-top: clamp(12px, 2vw, 24px);\n            border-top: 1px solid var(--border-color);\n            width: 100%;\n        }\n\n        .footer p {\n            margin-bottom: 8px;\n            line-height: 1.5;\n        }\n\n        /* Utility Classes */\n        .text-critical { color: var(--critical-color); }\n        .text-urgent { color: var(--urgent-color); }\n        .text-high { color: var(--high-color); }\n        .text-medium { color: var(--medium-color); }\n        .text-low { color: var(--low-color); }\n\n        .icon-small {\n            font-size: clamp(0.875rem, 1.5vw, 0.875rem);\n        }\n\n        .clickable {\n            cursor: pointer;\n            transition: opacity 0.2s;\n        }\n\n        .clickable:hover {\n            opacity: 0.8;\n        }\n\n        .hidden {\n            display: none !important;\n        }\n\n        /* Touch Device Optimizations */\n        @media (hover: none) and (pointer: coarse) {\n            .action-btn, .tab {\n                min-height: 44px;\n                min-width: 44px;\n            }\n            \n            input, button, .tab {\n                font-size: 16px !important;\n            }\n        }\n\n        /* Tablet */\n        @media (min-width: 768px) {\n            .header-section {\n                flex-direction: row;\n                flex-wrap: wrap;\n                align-items: center;\n                justify-content: space-between;\n            }\n            \n            .header-main {\n                flex: 1;\n                min-width: 0;\n            }\n            \n            .header-stats {\n                flex: 0 0 auto;\n                justify-content: flex-end;\n                margin-top: 0;\n            }\n            \n            .grid-2 {\n                grid-template-columns: repeat(2, 1fr);\n            }\n            \n            .grid-3 {\n                grid-template-columns: repeat(2, 1fr);\n            }\n            \n            .card-header {\n                flex-direction: row;\n                align-items: center;\n            }\n            \n            .list-item {\n                flex-direction: row;\n                align-items: flex-start;\n            }\n            \n            .list-item-action {\n                margin-top: 0;\n                align-self: center;\n            }\n            \n            .meeting-item {\n                flex-direction: row;\n                align-items: center;\n            }\n            \n            .meeting-time {\n                align-self: center;\n                min-width: 100px;\n            }\n        }\n\n        /* Desktop */\n        @media (min-width: 1024px) {\n            .grid-3 {\n                grid-template-columns: repeat(3, 1fr);\n            }\n            \n            .header-section {\n                flex-wrap: nowrap;\n            }\n            \n            .header-stats {\n                flex-wrap: nowrap;\n            }\n        }\n\n        /* Large Desktop */\n        @media (min-width: 1200px) {\n            .stat-box {\n                min-width: 140px;\n            }\n        }\n\n        /* Landscape Mobile */\n        @media (max-width: 896px) and (orientation: landscape) {\n            body {\n                padding: 8px;\n            }\n            \n            .container {\n                gap: 12px;\n            }\n            \n            .header-section {\n                padding: 12px;\n            }\n            \n            .header-subtitle {\n                flex-direction: column;\n                align-items: flex-start;\n                gap: 4px;\n            }\n            \n            .stat-box {\n                min-width: 100px;\n                padding: 8px 12px;\n            }\n            \n            .card {\n                padding: 12px;\n            }\n            \n            .list-item, .meeting-item {\n                padding: 10px;\n            }\n            \n            .tabs {\n                margin-bottom: 12px;\n            }\n            \n            .tab {\n                padding: 8px 12px;\n            }\n        }\n\n        /* Very Small Mobile */\n        @media (max-width: 360px) {\n            .header-subtitle {\n                flex-direction: column;\n                align-items: flex-start;\n                gap: 4px;\n            }\n            \n            .header-subtitle span {\n                font-size: 0.8rem;\n            }\n            \n            .stat-box {\n                min-width: 100px;\n                padding: 8px 12px;\n            }\n            \n            .stat-number {\n                font-size: 1.1rem;\n            }\n            \n            .stat-label {\n                font-size: 0.7rem;\n            }\n            \n            .badge {\n                padding: 2px 6px;\n                font-size: 0.6rem;\n            }\n            \n            .action-btn {\n                padding: 4px 8px;\n                font-size: 0.7rem;\n            }\n            \n            .tab {\n                padding: 6px 10px;\n                font-size: 0.7rem;\n            }\n        }\n\n        /* Dark Mode Support */\n        @media (prefers-color-scheme: dark) {\n            :root {\n                --bg-light: #1a1a1a;\n                --bg-white: #2d2d2d;\n                --border-color: #404040;\n                --text-primary: #e0e0e0;\n                --text-secondary: #a0a0a0;\n            }\n            \n            .alert-banner[style*=\"background: linear-gradient(135deg, var(--medium-color), #059669);\"] {\n                background: linear-gradient(135deg, #065f46, #059669) !important;\n            }\n            \n            .meeting-item {\n                background: #363636;\n            }\n        }\n\n        /* Reduced Motion */\n        @media (prefers-reduced-motion: reduce) {\n            .card, .action-btn, .clickable {\n                transition: none;\n            }\n            \n            .card:hover {\n                transform: none;\n            }\n        }\n\n        /* Print Styles */\n        @media print {\n            body {\n                background: white;\n                color: black;\n                padding: 0;\n                font-size: 12pt;\n            }\n            \n            .container {\n                max-width: none;\n                gap: 12pt;\n            }\n            \n            .card {\n                box-shadow: none;\n                border: 1px solid #ddd;\n                page-break-inside: avoid;\n            }\n            \n            .action-btn {\n                display: none;\n            }\n            \n            .footer {\n                border-top: 1px solid #ddd;\n            }\n            \n            @page {\n                margin: 1cm;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Header Section -->\n        <div class=\"header-section\">\n            <div class=\"header-main\">\n                <h1 id=\"morning-digest-title\">{{ $json.object[0].header.morning_digest }}</h1>\n                <div class=\"header-subtitle\">\n                    <span><i class=\"far fa-clock icon-small\"></i> Generated: <span id=\"generated-time\">{{ $json.object[0].header.generated }}</span></span>\n                    <span><i class=\"far fa-calendar icon-small\"></i> <span id=\"current-date\">{{ $json.object[0].header.morning_digest.replace('MORNING DIGEST - ', '') }}</span></span>\n                </div>\n            </div>\n            <div class=\"header-stats\">\n                <div class=\"stat-box\">\n                    <span class=\"stat-number\" id=\"email-count\">{{ $json.object[0].header.yesterdays_emails }}</span>\n                    <span class=\"stat-label\">Yesterday's Emails</span>\n                </div>\n                <div class=\"stat-box\">\n                    <span class=\"stat-number\" id=\"meeting-count\">{{ $json.object[0].header.upcoming_meetings }}</span>\n                    <span class=\"stat-label\">Upcoming Meetings</span>\n                </div>\n            </div>\n        </div>\n\n        <!-- Immediate Attention Required -->\n        {{$json.object[0].immediate_attention_required.critical_emails.length > 0 || $json.object[0].immediate_attention_required.critical_meetings_today.length > 0 ? `\n        <div class=\"alert-banner\" id=\"critical-alert\">\n            <i class=\"fas fa-exclamation-triangle alert-icon\"></i>\n            <div class=\"alert-content\">\n                <div class=\"alert-title\">Immediate Attention Required</div>\n                <div id=\"critical-alert-text\">\n                    Critical items require your immediate attention\n                </div>\n            </div>\n        </div>\n        ` : `\n        <div class=\"alert-banner\" style=\"background: linear-gradient(135deg, var(--medium-color), #059669);\" id=\"critical-alert\">\n            <i class=\"fas fa-check-circle alert-icon\"></i>\n            <div class=\"alert-content\">\n                <div class=\"alert-title\">All Clear</div>\n                <div id=\"critical-alert-text\">\n                    No critical items requiring immediate attention\n                </div>\n            </div>\n        </div>\n        ` }}\n\n        <!-- Two Column Grid: Critical Items & Today's Meetings -->\n        <div class=\"grid-2\">\n            <!-- Critical Emails Section -->\n            <div class=\"card\">\n                <div class=\"card-header\">\n                    <div class=\"card-title\">\n                        <i class=\"fas fa-fire text-critical icon-small\"></i>\n                        <span>Critical Emails</span>\n                        <span class=\"badge badge-critical\" id=\"critical-emails-count\">\n                            {{$json.object[0].immediate_attention_required.critical_emails.length }}\n                        </span>\n                    </div>\n                </div>\n                <div id=\"critical-emails-list\">\n                    {{ $json.object[0].immediate_attention_required.critical_emails.map(email => `\n                    <div class=\"list-item\">\n                        <div class=\"list-item-content\">\n                            <div class=\"list-item-title\">\n                                <i class=\"fas fa-envelope icon-small\"></i>\n                                <span class=\"email-message\">${email.message}</span>\n                            </div>\n                            <div class=\"list-item-action\">\n                                <a href=\"${email.link}\" target=\"_blank\" class=\"action-btn\">\n                                    <i class=\"fas fa-external-link-alt icon-small\"></i>\n                                    View Email\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                    `).join('') }}\n                    \n                    {{ $json.object[0].immediate_attention_required.critical_emails.length === 0 ? `\n                    <div class=\"empty-state\">\n                        <i class=\"far fa-check-circle\"></i>\n                        <p>No critical emails requiring immediate attention</p>\n                    </div>\n                    ` : '' }}\n                </div>\n            </div>\n\n            <!-- Critical Meetings Section -->\n            <div class=\"card\">\n                <div class=\"card-header\">\n                    <div class=\"card-title\">\n                        <i class=\"fas fa-calendar-times text-critical icon-small\"></i>\n                        <span>Critical Meetings Today</span>\n                        <span class=\"badge badge-critical\" id=\"critical-meetings-count\">\n                            {{ $json.object[0].immediate_attention_required.critical_meetings_today.length }}\n                        </span>\n                    </div>\n                </div>\n                <div id=\"critical-meetings-list\">\n                    {{ $json.object[0].immediate_attention_required.critical_meetings_today.map(meeting => `\n                    <div class=\"list-item\">\n                        <div class=\"list-item-content\">\n                            <div class=\"list-item-title\">\n                                <i class=\"fas fa-video icon-small\"></i>\n                                <span class=\"meeting-message\">${meeting.message}</span>\n                            </div>\n                            <div class=\"list-item-action\">\n                                <a href=\"${meeting.link}\" target=\"_blank\" class=\"action-btn\">\n                                    <i class=\"fas fa-calendar-alt icon-small\"></i>\n                                    Join Meeting\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                    `).join('') }}\n                    \n                    {{ $json.object[0].immediate_attention_required.critical_meetings_today.length === 0 ? `\n                    <div class=\"empty-state\">\n                        <i class=\"far fa-calendar-check\"></i>\n                        <p>No critical meetings requiring immediate attention</p>\n                    </div>\n                    ` : '' }}\n                </div>\n            </div>\n        </div>\n\n        <!-- Action Items Grid -->\n        <div class=\"grid-2\">\n            <!-- Action Required from Mails -->\n            <div class=\"card\">\n                <div class=\"card-header\">\n                    <div class=\"card-title\">\n                        <i class=\"fas fa-tasks text-urgent icon-small\"></i>\n                        <span>Action Required from Mails</span>\n                        <span class=\"badge badge-urgent\" id=\"mail-actions-count\">\n                            {{ $json.object[0].action_required_from_mails.length }}\n                        </span>\n                    </div>\n                </div>\n                <div id=\"mail-actions-list\">\n                    {{ $json.object[0].action_required_from_mails.map(action => `\n                    <div class=\"list-item\">\n                        <div class=\"list-item-content\">\n                            <div class=\"list-item-title\">\n                                <i class=\"fas fa-envelope-open-text icon-small\"></i>\n                                <span class=\"action-message\">${action.message}</span>\n                            </div>\n                            <div class=\"list-item-meta\">\n                                <span><i class=\"far fa-clock icon-small\"></i> Deadline: ${action.deadline}</span>\n                            </div>\n                            <div class=\"list-item-action\">\n                                <a href=\"${action.link}\" target=\"_blank\" class=\"action-btn\">\n                                    <i class=\"fas fa-external-link-alt icon-small\"></i>\n                                    View Source\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                    `).join('') }}\n                    \n                    {{ $json.object[0].action_required_from_mails.length === 0 ? `\n                    <div class=\"empty-state\">\n                        <i class=\"far fa-check-circle\"></i>\n                        <p>No pending actions from emails</p>\n                    </div>\n                    ` : '' }}\n                </div>\n            </div>\n\n            <!-- Action Required Before Meetings -->\n            <div class=\"card\">\n                <div class=\"card-header\">\n                    <div class=\"card-title\">\n                        <i class=\"fas fa-clipboard-list text-high icon-small\"></i>\n                        <span>Action Required Before Meetings</span>\n                        <span class=\"badge badge-high\" id=\"meeting-actions-count\">\n                            {{ $json.object[0].action_required_before_meetings.length }}\n                        </span>\n                    </div>\n                </div>\n                <div id=\"meeting-actions-list\">\n                    {{ $json.object[0].action_required_before_meetings.map(action => `\n                    <div class=\"list-item\">\n                        <div class=\"list-item-content\">\n                            <div class=\"list-item-title\">\n                                <i class=\"fas fa-clipboard-check icon-small\"></i>\n                                <span class=\"action-message\">${action.message}</span>\n                            </div>\n                            <div class=\"list-item-meta\">\n                                <span><i class=\"far fa-clock icon-small\"></i> Deadline: ${action.deadline}</span>\n                            </div>\n                            <div class=\"list-item-action\">\n                                <a href=\"${action.link}\" target=\"_blank\" class=\"action-btn\">\n                                    <i class=\"fas fa-calendar-alt icon-small\"></i>\n                                    View Meeting\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                    `).join('') }}\n                    \n                    {{ $json.object[0].action_required_before_meetings.length === 0 ? `\n                    <div class=\"empty-state\">\n                        <i class=\"far fa-check-circle\"></i>\n                        <p>No pending actions before meetings</p>\n                    </div>\n                    ` : '' }}\n                </div>\n            </div>\n        </div>\n\n        <!-- Email Digest with Tabs -->\n        <div class=\"card\">\n            <div class=\"card-header\">\n                <div class=\"card-title\">\n                    <i class=\"fas fa-inbox icon-small\"></i>\n                    <span>Email Digest</span>\n                    <span class=\"badge badge-informational\" id=\"total-emails-digest\">\n                        {{ $json.object[0].email_digest.critical.length + $json.object[0].email_digest.urgent.length + $json.object[0].email_digest.high.length + $json.object[0].email_digest.medium.length }}\n                    </span>\n                </div>\n            </div>\n            \n            <!-- Tabs for different urgency levels -->\n            <div class=\"tabs\" id=\"email-tabs\">\n                <div class=\"tab active\" data-tab=\"critical\" onclick=\"switchTab('critical')\">\n                    <i class=\"fas fa-fire\"></i> Critical ({{ $json.object[0].email_digest.critical.length }})\n                </div>\n                <div class=\"tab\" data-tab=\"urgent\" onclick=\"switchTab('urgent')\">\n                    <i class=\"fas fa-exclamation-circle\"></i> Urgent ({{ $json.object[0].email_digest.urgent.length }})\n                </div>\n                <div class=\"tab\" data-tab=\"high\" onclick=\"switchTab('high')\">\n                    <i class=\"fas fa-arrow-up\"></i> High ({{ $json.object[0].email_digest.high.length }})\n                </div>\n                <div class=\"tab\" data-tab=\"medium\" onclick=\"switchTab('medium')\">\n                    <i class=\"fas fa-minus-circle\"></i> Medium ({{ $json.object[0].email_digest.medium.length }})\n                </div>\n            </div>\n\n            <!-- Tab Contents -->\n            <div class=\"tab-content active\" id=\"tab-critical\">\n                {{ $json.object[0].email_digest.critical.map(email => `\n                <div class=\"list-item\">\n                    <div class=\"list-item-content\">\n                        <div class=\"list-item-title\">\n                            <i class=\"fas fa-fire text-critical icon-small\"></i>\n                            <span class=\"email-summary\">${email.summary}</span>\n                        </div>\n                        <div class=\"list-item-description\">\n                            Action: ${email.action} | Deadline: ${email.deadline}\n                        </div>\n                        <div class=\"list-item-action\">\n                            <a href=\"${email.link}\" target=\"_blank\" class=\"action-btn\">\n                                <i class=\"fas fa-external-link-alt icon-small\"></i>\n                                View Email\n                            </a>\n                        </div>\n                    </div>\n                </div>\n                `).join('') }}\n                \n                {{ $json.object[0].email_digest.critical.length === 0 ? `\n                <div class=\"empty-state\">\n                    <i class=\"far fa-check-circle\"></i>\n                    <p>No critical emails</p>\n                </div>\n                ` : '' }}\n            </div>\n\n            <div class=\"tab-content\" id=\"tab-urgent\">\n                {{ $json.object[0].email_digest.urgent.map(email => `\n                <div class=\"list-item\">\n                    <div class=\"list-item-content\">\n                        <div class=\"list-item-title\">\n                            <i class=\"fas fa-exclamation-circle text-urgent icon-small\"></i>\n                            <span class=\"email-summary\">${email.summary}</span>\n                        </div>\n                        <div class=\"list-item-description\">\n                            Action: ${email.action} | Deadline: ${email.deadline}\n                        </div>\n                        <div class=\"list-item-action\">\n                            <a href=\"${email.link}\" target=\"_blank\" class=\"action-btn\">\n                                <i class=\"fas fa-external-link-alt icon-small\"></i>\n                                View Email\n                            </a>\n                        </div>\n                    </div>\n                </div>\n                `).join('') }}\n                \n                {{ $json.object[0].email_digest.urgent.length === 0 ? `\n                <div class=\"empty-state\">\n                    <i class=\"far fa-check-circle\"></i>\n                    <p>No urgent emails</p>\n                </div>\n                ` : '' }}\n            </div>\n\n            <div class=\"tab-content\" id=\"tab-high\">\n                {{ $json.object[0].email_digest.high.map(email => `\n                <div class=\"list-item\">\n                    <div class=\"list-item-content\">\n                        <div class=\"list-item-title\">\n                            <i class=\"fas fa-arrow-up text-high icon-small\"></i>\n                            <span class=\"email-summary\">${email.summary}</span>\n                        </div>\n                        <div class=\"list-item-description\">\n                            Action: ${email.action} | Deadline: ${email.deadline}\n                        </div>\n                        <div class=\"list-item-action\">\n                            <a href=\"${email.link}\" target=\"_blank\" class=\"action-btn\">\n                                <i class=\"fas fa-external-link-alt icon-small\"></i>\n                                View Email\n                            </a>\n                        </div>\n                    </div>\n                </div>\n                `).join('') }}\n                \n                {{ $json.object[0].email_digest.high.length === 0 ? `\n                <div class=\"empty-state\">\n                    <i class=\"far fa-check-circle\"></i>\n                    <p>No high priority emails</p>\n                </div>\n                ` : '' }}\n            </div>\n\n            <div class=\"tab-content\" id=\"tab-medium\">\n                {{ $json.object[0].email_digest.medium.map(email => `\n                <div class=\"list-item\">\n                    <div class=\"list-item-content\">\n                        <div class=\"list-item-title\">\n                            <i class=\"fas fa-minus-circle text-medium icon-small\"></i>\n                            <span class=\"email-summary\">${email.summary}</span>\n                        </div>\n                        <div class=\"list-item-description\">\n                            Action: ${email.action} | Deadline: ${email.deadline}\n                        </div>\n                        <div class=\"list-item-action\">\n                            <a href=\"${email.link}\" target=\"_blank\" class=\"action-btn\">\n                                <i class=\"fas fa-external-link-alt icon-small\"></i>\n                                View Email\n                            </a>\n                        </div>\n                    </div>\n                </div>\n                `).join('') }}\n                \n                {{ $json.object[0].email_digest.medium.length === 0 ? `\n                <div class=\"empty-state\">\n                    <i class=\"far fa-check-circle\"></i>\n                    <p>No medium priority emails</p>\n                </div>\n                ` : '' }}\n            </div>\n        </div>\n\n        <!-- Today's Meetings -->\n        <div class=\"card\">\n            <div class=\"card-header\">\n                <div class=\"card-title\">\n                    <i class=\"fas fa-calendar-day text-primary icon-small\"></i>\n                    <span>Today's Meetings</span>\n                    <span class=\"badge\" style=\"background-color: var(--primary-color);\" id=\"todays-meetings-count\">\n                        {{ $json.object[0].todays_meetings.length }}\n                    </span>\n                </div>\n            </div>\n            <div id=\"todays-meetings-list\">\n                {{ $json.object[0].todays_meetings.map(meeting => `\n                <div class=\"meeting-item\">\n                    <div class=\"meeting-time\">${meeting.time}</div>\n                    <div class=\"meeting-details\">\n                        <div class=\"meeting-title\">${meeting.summary}</div>\n                        <div class=\"meeting-location\">\n                            <i class=\"fas fa-map-marker-alt icon-small\"></i>\n                            ${meeting.location}\n                        </div>\n                    </div>\n                    <div class=\"list-item-action\">\n                        <a href=\"${meeting.link}\" target=\"_blank\" class=\"action-btn\">\n                            <i class=\"fas fa-external-link-alt icon-small\"></i>\n                            Join\n                        </a>\n                    </div>\n                </div>\n                `).join('') }}\n                \n                {{ $json.object[0].todays_meetings.length === 0 ? `\n                <div class=\"empty-state\">\n                    <i class=\"far fa-calendar\"></i>\n                    <p>No meetings scheduled for today</p>\n                </div>\n                ` : '' }}\n            </div>\n        </div>\n\n        <!-- Awareness Items -->\n        <div class=\"card\">\n            <div class=\"card-header\">\n                <div class=\"card-title\">\n                    <i class=\"fas fa-info-circle text-informational icon-small\"></i>\n                    <span>Awareness Items</span>\n                    <span class=\"badge badge-informational\" id=\"awareness-items-count\">\n                        {{ $json.object[0].awareness_items.length }}\n                    </span>\n                </div>\n            </div>\n            <div id=\"awareness-items-list\">\n                {{ $json.object[0].awareness_items.map(item => `\n                <div class=\"list-item\">\n                    <div class=\"list-item-content\">\n                        <div class=\"list-item-title\">\n                            ${item.type === 'LOW' ? '<i class=\"fas fa-info-circle text-low icon-small\"></i>' : ''}\n                            ${item.type === 'INFORMATIONAL' ? '<i class=\"fas fa-newspaper text-informational icon-small\"></i>' : ''}\n                            ${item.type === 'PERSONAL' ? '<i class=\"fas fa-user text-personal icon-small\"></i>' : ''}\n                            <span class=\"badge badge-${item.type.toLowerCase()}\">${item.type}</span>\n                            <span class=\"item-summary\">${item.summary}</span>\n                        </div>\n                        <div class=\"list-item-action\">\n                            <a href=\"${item.link}\" target=\"_blank\" class=\"action-btn\">\n                                <i class=\"fas fa-external-link-alt icon-small\"></i>\n                                View\n                            </a>\n                        </div>\n                    </div>\n                </div>\n                `).join('') }}\n                \n                {{ $json.object[0].awareness_items.length === 0 ? `\n                <div class=\"empty-state\">\n                    <i class=\"far fa-check-circle\"></i>\n                    <p>No awareness items</p>\n                </div>\n                ` : '' }}\n            </div>\n        </div>\n\n        <!-- Footer -->\n        <div class=\"footer\">\n            <p>CTO Morning Digest â€¢ Generated Automatically â€¢ {{ $json.object[0].header.generated }} â€¢ {{ $json.object[0].header.morning_digest }}</p>\n            <p class=\"text-secondary\">Last refreshed: <span id=\"last-refresh\">{{ new Date().toLocaleTimeString() }}</span></p>\n        </div>\n    </div>\n\n    <script>\n        function switchTab(tabName) {\n            // Hide all tab contents\n            document.querySelectorAll('.tab-content').forEach(content => {\n                content.classList.remove('active');\n            });\n            \n            // Remove active class from all tabs\n            document.querySelectorAll('.tab').forEach(tab => {\n                tab.classList.remove('active');\n            });\n            \n            // Show selected tab content\n            document.getElementById('tab-' + tabName).classList.add('active');\n            \n            // Activate selected tab\n            document.querySelector(`.tab[data-tab=\"${tabName}\"]`).classList.add('active');\n        }\n        \n        // Initialize the first tab as active\n        document.addEventListener('DOMContentLoaded', function() {\n            switchTab('critical');\n            \n            // Handle responsive behavior\n            handleResponsive();\n            window.addEventListener('resize', handleResponsive);\n        });\n        \n        function handleResponsive() {\n            // Handle touch device optimizations\n            const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);\n            \n            if (isTouchDevice) {\n                document.body.classList.add('touch-device');\n            } else {\n                document.body.classList.remove('touch-device');\n            }\n            \n            // Adjust header layout on very small screens\n            if (window.innerWidth < 480) {\n                document.querySelectorAll('.card-title').forEach(title => {\n                    const icon = title.querySelector('.icon-small');\n                    if (icon) icon.style.fontSize = '0.8rem';\n                });\n            }\n        }\n    </script>\n</body>\n</html>"
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        2400,
        352
      ],
      "id": "fc07f935-dde2-494b-8820-4549fb8bc041",
      "name": "HTML"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "ec35a2ec-2ab1-40f8-a6b7-e9232f69eca4",
              "leftValue": "={{ $('Code in JavaScript3').item.json.daily_digest }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            },
            {
              "id": "22f13663-460c-4dfe-82d4-ec6c26bb7322",
              "leftValue": "={{ $('Code in JavaScript3').item.json.important_emails }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            },
            {
              "id": "03624926-1b1a-48b5-9ef0-2f2180dc66db",
              "leftValue": "={{ $('Code in JavaScript3').item.json.tasks }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1136,
        1040
      ],
      "id": "9c30a56e-b635-43b5-9f4e-a9f04ebdfeaf",
      "name": "If1",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "emails_ai",
          "mode": "list",
          "cachedResultName": "emails_ai"
        },
        "returnAll": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        2144,
        1520
      ],
      "id": "6e2ce0f4-8cf8-4475-8197-1b6d6832bb92",
      "name": "Get emails1",
      "credentials": {
        "postgres": {
          "id": "sgm1FkD3kU7pOVhf",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.query }}",
        "options": {
          "systemMessage": "=You are an intent classifier for a personal productivity assistant.\n\nInstructions:\n\nAnalyze the user's message and determine which task(s) they want to perform based on the Supported Intent Categories below.\n\nDate Extraction:\n\nExtract any date mentioned in the format YYYY-MM-DD.\n\nIf no date is mentioned, assume today's date (based on the current date when processing).\n\nIf the date is not explicitly required for the intent (e.g., for a general request without a date reference), return an empty string \"\" for the date field.\n\nResponse Rules:\n\nIf the user query is related to one or more of the Supported Intent Categories:\nReturn your response ONLY as a JSON object with this exact structure:\n\njson\n{\n  \"daily_digest\": boolean,\n  \"tasks\": boolean,\n  \"important_emails\": boolean,\n  \"date\": \"string\"\n}\n\n\nSupported Intent Categories:\n\ndaily_digest â€“ User wants to generate or view their daily digest/summary.\n\ntasks â€“ User wants to see their tasks or to-dos.\n\nimportant_emails â€“ User wants to see only important emails.\n\nExamples:\n\nUser: \"show me my tasks for tomorrow\"\nResponse (JSON):\n\njson\n{\n  \"daily_digest\": false,\n  \"tasks\": true,\n  \"important_emails\": false,\n  \"date\": \"2024-01-15\"\n}\nUser: \"give me my daily summary\"\nResponse (JSON):\n\njson\n{\n  \"daily_digest\": true,\n  \"tasks\": false,\n  \"important_emails\": false,\n  \"date\": \"\"\n}\nUser: \"show important emails from yesterday\"\nResponse (JSON):\n\njson\n{\n  \"daily_digest\": false,\n  \"tasks\": false,\n  \"important_emails\": true,\n  \"date\": \"2024-01-13\"\n}\nUser: \"show me my tasks and important emails\"\nResponse (JSON):\n\njson\n{\n  \"daily_digest\": false,\n  \"tasks\": true,\n  \"important_emails\": true,\n  \"date\": \"\"\n}\nUser: \"Can I get my daily digest?\"\nResponse (JSON):\n\njson\n{\n  \"daily_digest\": true,\n  \"tasks\": false,\n  \"important_emails\": false,\n  \"date\": \"\"\n}\nUser: \"Show me my tasks for January 20th\"\nResponse (JSON):\n\njson\n{\n  \"daily_digest\": false,\n  \"tasks\": true,\n  \"important_emails\": false,\n  \"date\": \"2024-01-20\"\n}\nUser: \"What are my important emails from last Friday?\"\nResponse (JSON):\n\njson\n{\n  \"daily_digest\": false,\n  \"tasks\": false,\n  \"important_emails\": true,\n  \"date\": \"2024-01-12\"\n}\nUser: \"Give me my daily summary and tasks for today\"\nResponse (JSON):\n\njson\n{\n  \"daily_digest\": true,\n  \"tasks\": true,\n  \"important_emails\": false,\n  \"date\": \"\"\n}\nUser: \"What's the weather like?\"\nResponse (JSON):\n\njson\n{\n  \"daily_digest\": false,\n  \"tasks\": false,\n  \"important_emails\": false,\n  \"date\": \"\"\n}\n\nUser: \"Hi\"\nResponse (JSON):\n\njson\n{\n  \"daily_digest\": false,\n  \"tasks\": false,\n  \"important_emails\": false,\n  \"date\": \"\"\n}\n\nUser: \"Any other user not related to important_emails,tasks and daily_digest\"\nResponse (JSON):\n\njson\n{\n  \"daily_digest\": false,\n  \"tasks\": false,\n  \"important_emails\": false,\n  \"date\": \"\"\n}\nNote:\n\nFor date extraction, \"today\" refers to the current date when processing the query.\n\nThe response must strictly adhere to the format based on the query's relevance to the Supported Intent Categories."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -48,
        1040
      ],
      "id": "9bd216b5-52fd-4c05-acab-5dc7a099b728",
      "name": "AI Agent2"
    },
    {
      "parameters": {
        "model": "open-mistral-7b",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
      "typeVersion": 1,
      "position": [
        -176,
        1248
      ],
      "id": "1093c2de-1b69-434f-a1fa-030f061450c7",
      "name": "Mistral Cloud Chat Model2",
      "credentials": {
        "mistralCloudApi": {
          "id": "r1gnyzVtkR4gGLJD",
          "name": "Mistral Cloud account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get the string output from previous node (AI Agent)\nlet raw = $input.first().json.output;\n\n// Ensure it's a string\nif (typeof raw === 'string') {\n  raw = raw\n    // Remove leading ```json or ``` if present\n    .replace(/```json/gi, '')\n    .replace(/```/g, '')\n    // Remove leading \"json\\n\" or \"json\\r\\n\"\n    .replace(/^json\\s*/i, '')\n    .trim();\n}\n\ntry {\n  // Convert cleaned string â†’ JSON object\n  const parsed = JSON.parse(raw);\n\n  // Return as n8n-compatible JSON\n  return [\n    {\n      json: parsed\n    }\n  ];\n} catch (error) {\n  // Fallback if JSON parsing fails\n  return [\n    {\n      json: {\n        output: raw,\n        parseError: true,\n        errorMessage: error.message\n      }\n    }\n  ];\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        384,
        1040
      ],
      "id": "75271856-e84d-4eac-9a3e-3906e3b9c940",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Aggregate5').item.json.data }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        2080,
        832
      ],
      "id": "f43e43ec-3c66-44a5-aa32-0c0bfade62f3",
      "name": "AI Agent4"
    },
    {
      "parameters": {
        "model": "open-mistral-7b",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
      "typeVersion": 1,
      "position": [
        1952,
        1040
      ],
      "id": "73e55bf0-14f9-4ce4-9e2b-c317fe4fd650",
      "name": "Mistral Cloud Chat Model4",
      "credentials": {
        "mistralCloudApi": {
          "id": "r1gnyzVtkR4gGLJD",
          "name": "Mistral Cloud account 2"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "666ef53a-e162-49df-ba35-0d0ce6388818",
              "name": "query",
              "value": "={{ $('Webhook').item.json.query }}",
              "type": "object"
            },
            {
              "id": "51f63d1e-ea6e-47eb-bf6e-e147bed765eb",
              "name": "date",
              "value": "={{ $json.date || $now}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        720,
        1040
      ],
      "id": "1911d6ab-dfb4-46ff-b94d-45ce08358d52",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        928,
        1040
      ],
      "id": "0c73de9b-8073-45c1-8c3f-39916cabe317",
      "name": "Aggregate5"
    },
    {
      "parameters": {
        "jsCode": "return [{json:$input.first().json.content}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1984,
        352
      ],
      "id": "e79d0362-187b-480f-bdda-e02012eed6e2",
      "name": "Code in JavaScript4"
    },
    {
      "parameters": {
        "jsCode": "return [\n  {\n    json: {\n      html: \"System is only capable to do extract tasks, summarize tasks, and generate daily digest\"\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1344,
        944
      ],
      "id": "377a89a6-c6c5-44e7-881b-d64fde54429e",
      "name": "Code in JavaScript5"
    },
    {
      "parameters": {
        "content": "Name:\nâœ¨ AI Executive Assistant â€“ Smart Morning Digest âœ¨\n\nPurpose:\nA local, AI-powered automation system that acts as a virtual executive assistant by intelligently reading emails and calendar events, identifying what truly matters, extracting actionable tasks, and prioritizing the day ahead. It generates a clean, executive-friendly morning digest that highlights urgent items, upcoming meetings, and follow-upsâ€”helping start each day with clarity, focus, and control.",
        "height": 2588,
        "width": 6328
      },
      "id": "8b73d1ec-da2f-48f4-8e15-9c481f2509e3",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -448,
        208
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Workflow 2 - Generating AI Summary and Storing them",
        "height": 336,
        "width": 1376
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3024,
        704
      ],
      "typeVersion": 1,
      "id": "09a9dc51-d218-4935-89e8-8ac3c19a2ad5",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "Workflow 3 - Creating Task and Prioritization",
        "height": 400,
        "width": 2240
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3056,
        1056
      ],
      "typeVersion": 1,
      "id": "9f6b2729-ff8c-4577-b55d-e03f6c96a692",
      "name": "Sticky Note3"
    }
  ],
  "pinData": {},
  "connections": {
    "Fetch Emails - Past 24 Hours": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Insert summary of email in email ai table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Insert mail in a email table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Insert events in a calendar table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate2": {
      "main": [
        [
          {
            "node": "get calendar events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Aggregate3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate3": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Aggregate4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mistral Cloud Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Mistral Cloud Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Get emails": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get summary of the email": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get calendar events": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert summary of email in email ai table": {
      "main": [
        [
          {
            "node": "get summary of the email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert mail in a email table": {
      "main": [
        [
          {
            "node": "next day calendar events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert events in a calendar table": {
      "main": [
        [
          {
            "node": "Get emails",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "next day calendar events": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate4": {
      "main": [
        [
          {
            "node": "Insert today digest in a daily digest table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "AI Agent2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tasks": {
      "ai_tool": [
        [
          {
            "node": "AI Agent4",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Select rows from a table",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mistral Cloud Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [],
        [
          {
            "node": "Fetch Emails - Past 24 Hours",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Code in JavaScript5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get emails1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent2": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mistral Cloud Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mistral Cloud Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent4",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Aggregate5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate5": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript4": {
      "main": [
        [
          {
            "node": "HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "9cb4c174-bbac-403a-879c-84bb7f60f84b",
  "meta": {
    "templateId": "5003",
    "templateCredsSetupCompleted": true,
    "instanceId": "e91500adc6b9d5c04c07524a89d5dd1212a1463f53b577bc9ee6ec31526e0c6a"
  },
  "id": "SAAoIK64M67YA4Vn",
  "tags": []
}