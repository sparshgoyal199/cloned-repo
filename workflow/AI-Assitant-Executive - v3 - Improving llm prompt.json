{
  "name": "AI-Assitant-Executive - v3 - Improving llm prompt",
  "nodes": [
    {
      "parameters": {
        "operation": "getAll",
        "returnAll": true,
        "simple": false,
        "filters": {
          "q": "={{ \n (() => {\n const yesterday = new Date();\n yesterday.setDate(yesterday.getDate() - 1);\n return `after:${yesterday.getFullYear()}/${(yesterday.getMonth() + 1).toString().padStart(2, '0')}/${yesterday.getDate().toString().padStart(2, '0')}`;\n })()\n}}"
        },
        "options": {}
      },
      "id": "3fa7763a-2e48-4c0c-87ae-9daeb61131b0",
      "name": "Fetch Emails - Past 24 Hours",
      "type": "n8n-nodes-base.gmail",
      "position": [
        992,
        512
      ],
      "webhookId": "fc4143cf-c3c6-4be6-b1b6-9f2de8e8ee16",
      "typeVersion": 2.1,
      "executeOnce": true,
      "credentials": {
        "gmailOAuth2": {
          "id": "hz9dBCQo0ot60lCE",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "content": "Name:\nâœ¨ AI Executive Assistant â€“ Smart Morning Digest âœ¨\n\nPurpose:\nA local, AI-powered automation system that acts as a virtual executive assistant by intelligently reading emails and calendar events, identifying what truly matters, extracting actionable tasks, and prioritizing the day ahead. It generates a clean, executive-friendly morning digest that highlights urgent items, upcoming meetings, and follow-upsâ€”helping start each day with clarity, focus, and control.",
        "height": 1388,
        "width": 3112
      },
      "id": "8b73d1ec-da2f-48f4-8e15-9c481f2509e3",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        192,
        304
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.data }}",
        "options": {
          "systemMessage": "=You are an AI executive assistant specialized in processing emails for a high-level CTO of a technology company. Your task is to analyze ALL emails and categorize them with detailed priority levels for daily digest.\n\n## CTO CONTEXT:\n- Role: Chief Technology Officer overseeing product development, engineering teams, technology strategy, and AI/ML initiatives\n- Company: Tech company with focus on AI solutions (Flexilytics AI in this case)\n- Reports to: CEO/Board\n- Manages: Engineering teams, Product development, Technical architecture, AI/ML teams\n- Key responsibilities: Technology strategy, Product roadmaps, Technical hiring, Budget oversight, Vendor decisions, Security/Compliance\n\n## INCLUSION PHILOSOPHY:\nInclude ALL emails but categorize them appropriately. Even low-priority emails should be included in the digest so the CTO has complete visibility.\n\n## PRIORITY LEVEL SYSTEM (7 Levels with Clear Behavioral Triggers):\n\n### **1ï¸âƒ£ CRITICAL ðŸš¨ - IMMEDIATE ACTION REQUIRED**\n**Definition:** Anything that can stop the company, damage trust, or escalate to the board if not acted on immediately.\n**Triggers:**\n- Production outage / security breach\n- Major customer escalation\n- Legal / compliance risk\n- Board or CEO escalation\n- Missed go-live / SLA breach happening now\n**Examples:** \"Production down for payments in EU region\", \"Security vulnerability exploited in core system\", \"CEO needs approval in 2 hours\"\n**CTO Behavior:** Drops everything, acts immediately\n\n### **2ï¸âƒ£ URGENT ðŸ”¥ - TIME-BOUND DECISIONS**\n**Definition:** Important issues with a hard deadline that will block teams if ignored.\n**Triggers:**\n- Budget approvals with deadline\n- Vendor renewal expiring\n- Hiring approval blocking onboarding\n- Customer escalation with deadline\n**Examples:** \"Need approval by EOD to release funds\", \"Vendor contract expires tomorrow\", \"Hiring decision needed before offer expires\"\n**CTO Behavior:** Scheduled action today, delegates with follow-up\n\n### **3ï¸âƒ£ HIGH âš¡ - HIGH BUSINESS IMPACT, NOT ON FIRE**\n**Definition:** Strategic or execution-critical topics that shape outcomes, but don't explode today.\n**Triggers:**\n- Architecture decisions\n- Roadmap changes\n- Platform scalability discussions\n- Key partner or enterprise customer discussions\n**Examples:** \"Proposed architecture change for next quarter\", \"Customer asking for roadmap commitment\", \"Engineering velocity concerns\"\n**CTO Behavior:** Reviews carefully, plans discussion\n\n### **4ï¸âƒ£ MEDIUM ðŸ“Œ - IMPORTANT AWARENESS, NO IMMEDIATE ACTION**\n**Definition:** Matters worth knowing but not blocking execution.\n**Triggers:**\n- Status updates\n- Weekly summaries\n- FYI leadership updates\n- Non-blocking risks\n**Examples:** \"Weekly engineering metrics\", \"Sprint retrospective summary\", \"FYI on infra optimization\"\n**CTO Behavior:** Skims, uses for context\n\n### **5ï¸âƒ£ LOW ðŸ§¾ - NICE TO KNOW, LOW IMPACT**\n**Definition:** Useful information with minimal influence on decisions.\n**Triggers:**\n- General updates\n- Non-critical vendor info\n- Internal announcements\n**Examples:** \"Tool upgrade announcement\", \"Team event update\", \"Minor policy changes\"\n**CTO Behavior:** Reads if time permits\n\n### **6ï¸âƒ£ INFORMATIONAL ðŸ“¬ - NO ACTION, PURE NOISE FOR CTO**\n**Definition:** Emails that should not consume CTO attention.\n**Triggers:**\n- Newsletters\n- Automated alerts\n- Generic HR or IT broadcasts\n- Sales cold emails\n**Examples:** \"Monthly product newsletter\", \"You have been added to Jira\", \"Introducing our AI solution\"\n**CTO Behavior:** Should never see these\n\n### **7ï¸âƒ£ PERSONAL ðŸ‘¤ - HUMAN, NON-WORK EMAILS**\n**Definition:** Emails not related to company operations.\n**Triggers:**\n- Personal messages\n- Social invitations\n- External non-work conversations\n**Examples:** \"Catching up this weekend?\", \"Happy Birthday\", \"Personal travel info\"\n**CTO Behavior:** Read privately, not in work digest\n\n## CATEGORIES (For Better Organization):\n- \"Strategic Planning\" - Company/department strategy\n- \"Resource Management\" - Budget, hiring, allocations\n- \"Project Management\" - Project updates, deadlines\n- \"Technical Decision\" - Architecture, tech stack, security\n- \"Vendor/Partnership\" - Vendors, partnerships, contracts\n- \"Compliance/Security\" - Security, compliance, legal\n- \"Executive Communication\" - CEO/Board/C-level\n- \"Team Management\" - Team updates, 1:1s, HR matters\n- \"Client/Stakeholder\" - Client communications, escalations\n- \"Industry/News\" - Newsletters, industry updates\n- \"Personal/Admin\" - Personal, admin, logistics\n- \"Meeting/Event\" - Meeting invites, event coordination\n\n## OUTPUT FORMAT (STRICT JSON for ALL emails):\n```json\n{\n  \"summary\": \"2-3 sentence concise summary. For low-priority: 'TechCrunch newsletter covering latest AI developments. No action required.'\",\n  \"urgency\": \"CRITICAL/URGENT/HIGH/MEDIUM/LOW/INFORMATIONAL/PERSONAL\",\n  \"category\": \"One of the categories above\",\n  \"action_items\": [\n    {\n      \"action\": \"Specific action if any, else 'No action required'\",\n      \"deadline\": \"YYYY-MM-DD or 'None' or timeframe\",\n      \"owner\": \"CTO/Team/System/Auto\",\n      \"priority\": \"High/Medium/Low/None\"\n    }\n  ],\n  \"created_at\": \"Current timestamp in ISO format: YYYY-MM-DDTHH:MM:SSZ\",\n  \"message_id_url\": \"Email identifier\"\n}\nEMAIL CLASSIFICATION EXAMPLES:\nEmail 1: \"PRODUCTION DOWN: Client X System Outage\"\n\njson\n{\n  \"summary\": \"Production system outage reported for Client X. Engineering team investigating root cause. Customer support receiving multiple complaints.\",\n  \"urgency\": \"CRITICAL\",\n  \"category\": \"Compliance/Security\",\n  \"action_items\": [\n    {\n      \"action\": \"Join emergency bridge call with engineering\",\n      \"deadline\": \"Today 11:00 AM\",\n      \"owner\": \"CTO\",\n      \"priority\": \"High\"\n    }\n  ],\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"message_id_url\": \"emergency_001@thread.id\"\n}\nEmail 2: \"TechCrunch AI Newsletter\"\n\njson\n{\n  \"summary\": \"Weekly TechCrunch newsletter covering latest AI funding rounds and product launches. Includes analysis of competitor movements.\",\n  \"urgency\": \"INFORMATIONAL\",\n  \"category\": \"Industry/News\",\n  \"action_items\": [\n    {\n      \"action\": \"No action required\",\n      \"deadline\": \"None\",\n      \"owner\": \"None\",\n      \"priority\": \"None\"\n    }\n  ],\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"message_id_url\": \"newsletter_002@thread.id\"\n}\nEmail 3: \"Team Lunch Invitation - Friday\"\n\njson\n{\n  \"summary\": \"Engineering team lunch invitation for Friday at 1 PM. RSVP requested by Thursday.\",\n  \"urgency\": \"LOW\",\n  \"category\": \"Team Management\",\n  \"action_items\": [\n    {\n      \"action\": \"RSVP for team lunch\",\n      \"deadline\": \"2024-01-18\",\n      \"owner\": \"CTO\",\n      \"priority\": \"Low\"\n    }\n  ],\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"message_id_url\": \"social_003@thread.id\"\n}\nEmail 4: \"LinkedIn: Connection Request from Jane Doe\"\n\njson\n{\n  \"summary\": \"LinkedIn connection request from Jane Doe, Head of AI at Competitor Inc. Optional connection.\",\n  \"urgency\": \"PERSONAL\",\n  \"category\": \"Personal/Admin\",\n  \"action_items\": [\n    {\n      \"action\": \"Review connection request\",\n      \"deadline\": \"None\",\n      \"owner\": \"CTO\",\n      \"priority\": \"None\"\n    }\n  ],\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"message_id_url\": \"linkedin_004@thread.id\"\n}\nEmail 5: \"Q3 Budget Approval Required by Friday\"\n\njson\n{\n  \"summary\": \"Q3 engineering budget requires CTO approval by Friday. Includes new headcount requests and infrastructure upgrades.\",\n  \"urgency\": \"URGENT\",\n  \"category\": \"Resource Management\",\n  \"action_items\": [\n    {\n      \"action\": \"Review and approve Q3 budget\",\n      \"deadline\": \"2024-01-19\",\n      \"owner\": \"CTO\",\n      \"priority\": \"High\"\n    }\n  ],\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"message_id_url\": \"budget_005@thread.id\"\n}\nEmail 6: \"Weekly Engineering Metrics Report\"\n\njson\n{\n  \"summary\": \"Weekly engineering metrics show velocity improved by 15% but bug count increased by 10%. Deployment frequency remains stable.\",\n  \"urgency\": \"MEDIUM\",\n  \"category\": \"Team Management\",\n  \"action_items\": [\n    {\n      \"action\": \"Discuss bug increase with engineering leads\",\n      \"deadline\": \"2024-01-22\",\n      \"owner\": \"CTO\",\n      \"priority\": \"Medium\"\n    }\n  ],\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"message_id_url\": \"metrics_006@thread.id\"\n}\nPROCESSING RULES:\nINCLUDE ALL EMAILS - Process every single email, no filtering\n\nAssign urgency based on the 7-level system - Use exact urgency labels: CRITICAL, URGENT, HIGH, MEDIUM, LOW, INFORMATIONAL, PERSONAL\n\nCreate meaningful summaries - Even for low-priority emails\n\nAction items should reflect urgency - CRITICAL/URGENT get specific actions with deadlines\n\nUse current timestamp for created_at in ISO format\n\nCategory selection should be accurate for easy filtering\n\nFor newsletters/news - Summarize 2-3 key topics covered\n\nFor meeting invites - Note date, time, required preparation\n\nFor personal emails - Keep summary professional\n\nSPECIAL INSTRUCTIONS:\nNewsletters: Summarize 2-3 key topics mentioned\n\nMeeting invites: Note date, time, required preparation\n\nAutomated alerts: Note if any require follow-up\n\nPersonal emails: Keep summary professional\n\nMultiple similar emails: Group conceptually in summary\n\nAttachments: Note if important documents are attached\n\nDO NOT include \"priority\" field - Only use \"urgency\" field with the 7 defined levels\n\nFINAL OUTPUT REQUIREMENT:\nOutput ONLY valid JSON array with one object per email. Each object MUST contain exactly these fields:\n\nsummary\n\nurgency\n\ncategory\n\naction_items\n\ncreated_at\n\nmessage_id_url\n\nExample:\n\njson\n[\n  {\n    \"summary\": \"...\",\n    \"urgency\": \"CRITICAL\",\n    \"category\": \"Compliance/Security\",\n    \"action_items\": [...],\n    \"created_at\": \"2024-01-15T10:30:00Z\",\n    \"message_id_url\": \"email_001@thread.id\"\n  }\n]\nNo additional text, explanations, or markdown outside the JSON structure."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        1456,
        848
      ],
      "id": "ead71014-deec-426d-a0f5-ef7b820f2217",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1024,
        848
      ],
      "id": "1b29f64f-d857-4bd1-a896-5e99430bf8f4",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "jsCode": "// Get raw LLM output text\nconst rawText = $input.first().json.output;\n\nlet items = [];\n\ntry {\n  // Clean the text first - remove ```json and ```\n  let cleanText = rawText.trim();\n  \n  // Remove markdown code blocks\n  if (cleanText.startsWith('```json')) {\n    cleanText = cleanText.replace(/^```json\\s*/, '').replace(/\\s*```$/, '');\n  } else if (cleanText.startsWith('```')) {\n    cleanText = cleanText.replace(/^```\\s*/, '').replace(/\\s*```$/, '');\n  }\n  \n  // Fix the JSON syntax errors - remove extra closing brackets and commas\n  // The issue is there are ]}, where it should be },\n  cleanText = cleanText.replace(/\\]\\s*,\\s*\\{/g, '},{');\n  \n  // Also handle any trailing commas before closing bracket\n  cleanText = cleanText.replace(/,\\s*\\]/g, ']');\n  \n  // Parse the cleaned JSON\n  const parsed = JSON.parse(cleanText);\n  \n  if (Array.isArray(parsed)) {\n    items = parsed\n      .filter(item => item !== null)\n      .map(item => ({ json: item }));\n  } else if (parsed !== null) {\n    items = [{ json: parsed }];\n  }\n  \n} catch (parseError) {\n  console.log(`Initial parse failed: ${parseError.message}`);\n  \n  // Try a more aggressive cleanup\n  try {\n    // Extract just the array content\n    const arrayMatch = rawText.match(/\\[\\s*(\\{[\\s\\S]*\\})\\s*\\]/);\n    \n    if (arrayMatch) {\n      let arrayContent = arrayMatch[1];\n      \n      // Fix the specific syntax errors in your JSON\n      // Replace \"], {\" with just \",{\"\n      arrayContent = arrayContent.replace(/\\]\\s*,\\s*\\{/g, ',{');\n      \n      // Wrap it back in array brackets\n      const fixedJson = '[' + arrayContent + ']';\n      \n      const parsed = JSON.parse(fixedJson);\n      \n      if (Array.isArray(parsed)) {\n        items = parsed\n          .filter(item => item !== null)\n          .map(item => ({ json: item }));\n      }\n    }\n  } catch (secondError) {\n    console.log(`Second attempt also failed: ${secondError.message}`);\n    \n    // Last resort: try to extract individual objects\n    const objectMatches = rawText.match(/\\{[^{}]*\\}/g);\n    \n    if (objectMatches) {\n      for (const match of objectMatches) {\n        try {\n          const obj = JSON.parse(match);\n          if (obj && typeof obj === 'object' && obj.id) {\n            items.push({ json: obj });\n          }\n        } catch (e) {\n          // Skip invalid objects\n          continue;\n        }\n      }\n    }\n  }\n}\n\n// Return the items in n8n format\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1808,
        848
      ],
      "id": "609eb34f-e108-4604-a697-eb4b0b1b1f16",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "content": "Workflow 1 - Retreiving and storing data into database",
        "height": 256,
        "width": 1648
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        608,
        448
      ],
      "typeVersion": 1,
      "id": "ca6c0243-2391-4dd9-8855-4847072fd59a",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2fe8d01e-48da-4501-9884-78c12ca67341",
              "name": "url",
              "value": "=https://mail.google.com/mail/u/0/#search/rfc822msgid:{{$json.messageId}}",
              "type": "string"
            },
            {
              "id": "67d15cc8-178a-47f7-8efe-f76aad296dfb",
              "name": "labelIds",
              "value": "={{ $json.labelIds }}",
              "type": "array"
            },
            {
              "id": "8bd7878b-f4f9-4135-b4c5-fd2df35de423",
              "name": "text",
              "value": "={{ $json.text }}",
              "type": "string"
            },
            {
              "id": "85bf5829-ae0f-40e3-8a12-0257064643ff",
              "name": "subject",
              "value": "={{ $json.subject }}",
              "type": "string"
            },
            {
              "id": "b09a6df5-cf82-4edb-81db-75215a82c349",
              "name": "from",
              "value": "={{ $json.from }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1184,
        512
      ],
      "id": "8fd5a901-f6f6-45e6-8658-5f980612d60c",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f5e909ed-b57f-4b50-b2dd-091d536ec7ad",
              "name": "id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "f29ee1bd-4991-41fe-b462-f0e16b46a6e3",
              "name": "summary",
              "value": "={{ $json.summary }}",
              "type": "string"
            },
            {
              "id": "2e639176-1771-43f8-90d7-6bee917458cb",
              "name": "start.dateTime",
              "value": "={{ $json.start.dateTime }}",
              "type": "string"
            },
            {
              "id": "6777a0e7-9a94-4f9b-be41-072a20a1360e",
              "name": "end.dateTime",
              "value": "={{ $json.end.dateTime }}",
              "type": "string"
            },
            {
              "id": "c566936d-0477-4ab6-bf0d-37b2c9263d1b",
              "name": "created",
              "value": "={{ $json.created }}",
              "type": "string"
            },
            {
              "id": "56f0c659-2c59-45a7-b3ec-c0a6a4e00759",
              "name": "description",
              "value": "={{ $json.description || null}}",
              "type": "string"
            },
            {
              "id": "b1b4937d-1ee9-4dca-8257-41611ec65fc0",
              "name": "htmlLink",
              "value": "={{ $json.htmlLink }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2016,
        512
      ],
      "id": "82085952-c7da-4125-bf5e-4013ff3dfde2",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "content": "Workflow 2 - Generating AI Summary and Storing them",
        "height": 336,
        "width": 1376
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        608,
        784
      ],
      "typeVersion": 1,
      "id": "09a9dc51-d218-4935-89e8-8ac3c19a2ad5",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.data }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=You are an AI assistant creating a structured morning digest for a CTO. Based on processed emails and calendar meetings, generate ONLY a JSON object with the following structure:\n\n## INPUT DATA:\n- Processed emails with fields: summary, urgency, category, action_items, created_at, message_id_url\n- Calendar meetings for next 7 days with: start_time, end_time, title, description, location, attendees, html_link\n\n## OUTPUT FORMAT (STRICT JSON ONLY - NO OTHER TEXT):\n\n```json\n{\n  \"header\": {\n    \"morning_digest\": \"MORNING DIGEST - [Current Date in Month DD, YYYY format]\",\n    \"generated\": \"[Current Time in HH:MM AM/PM format]\",\n    \"yesterdays_emails\": [Total count of processed emails],\n    \"upcoming_meetings\": [Total count of meetings in next 7 days]\n  },\n  \n  \"immediate_attention_required\": {\n    \"critical_emails\": [\n      {\n        \"message\": \"One-line summary of CRITICAL email 1\",\n        \"link\": \"message_id_url from email 1\"\n      },\n      {\n        \"message\": \"One-line summary of CRITICAL email 2\",\n        \"link\": \"message_id_url from email 2\"\n      }\n    ],\n    \"critical_meetings_today\": [\n      {\n        \"message\": \"One-line summary of today's critical meeting 1\",\n        \"link\": \"html_link from meeting 1\"\n      },\n      {\n        \"message\": \"One-line summary of today's critical meeting 2\",\n        \"link\": \"html_link from meeting 2\"\n      }\n    ]\n  },\n  \n  \"action_required_from_mails\": [\n    {\n      \"message\": \"Action item 1 from CRITICAL/URGENT/HIGH emails\",\n      \"deadline\": \"Corresponding deadline for action 1\",\n      \"link\": \"message_id_url from corresponding email\"\n    },\n    {\n      \"message\": \"Action item 2 from CRITICAL/URGENT/HIGH emails\",\n      \"deadline\": \"Corresponding deadline for action 2\",\n      \"link\": \"message_id_url from corresponding email\"\n    }\n  ],\n  \n  \"action_required_before_meetings\": [\n    {\n      \"message\": \"Preparation action for meeting 1\",\n      \"deadline\": \"Meeting start time (format as Today HH:MM or Date)\",\n      \"link\": \"html_link from meeting 1\"\n    },\n    {\n      \"message\": \"Preparation action for meeting 2\",\n      \"deadline\": \"Meeting start time (format as Today HH:MM or Date)\",\n      \"link\": \"html_link from meeting 2\"\n    }\n  ],\n  \n  \"email_digest\": {\n    \"critical\": [\n      {\n        \"summary\": \"2-3 line summary of CRITICAL email 1\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 1\"\n      },\n      {\n        \"summary\": \"2-3 line summary of CRITICAL email 2\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 2\"\n      }\n    ],\n    \"urgent\": [\n      {\n        \"summary\": \"2-3 line summary of URGENT email 1\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 1\"\n      },\n      {\n        \"summary\": \"2-3 line summary of URGENT email 2\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 2\"\n      }\n    ],\n    \"high\": [\n      {\n        \"summary\": \"2-3 line summary of HIGH email 1\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 1\"\n      },\n      {\n        \"summary\": \"2-3 line summary of HIGH email 2\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 2\"\n      }\n    ],\n    \"medium\": [\n      {\n        \"summary\": \"2-3 line summary of MEDIUM email 1\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 1\"\n      },\n      {\n        \"summary\": \"2-3 line summary of MEDIUM email 2\",\n        \"action\": \"Required action from action_items\",\n        \"deadline\": \"Action deadline\",\n        \"link\": \"message_id_url from email 2\"\n      }\n    ]\n  },\n  \n  \"todays_meetings\": [\n    {\n      \"time\": \"Start-End time (e.g., 10:00-10:30)\",\n      \"summary\": \"Meeting title and one-line purpose\",\n      \"location\": \"Meeting location/virtual link\",\n      \"link\": \"html_link from meeting\"\n    }\n  ],\n  \n  \"awareness_items\": [\n    {\n      \"type\": \"LOW\",\n      \"summary\": \"One-line summary of LOW urgency email\",\n      \"link\": \"message_id_url from email\"\n    },\n    {\n      \"type\": \"INFORMATIONAL\",\n      \"summary\": \"One-line summary of INFORMATIONAL email\",\n      \"link\": \"message_id_url from email\"\n    },\n    {\n      \"type\": \"PERSONAL\",\n      \"summary\": \"One-line summary of PERSONAL email\",\n      \"link\": \"message_id_url from email\"\n    }\n  ]\n}\nPROCESSING RULES:\n1. HEADER:\nUse current date and time (e.g., \"January 16, 2024\", \"8:00 AM\")\n\nCount total emails processed (all urgency levels)\n\nCount total meetings in next 7 days\n\n2. IMMEDIATE ATTENTION REQUIRED:\ncritical_emails: Include ONLY emails with urgency = \"CRITICAL\"\n\nFormat: Extract concise one-line summary from email's summary field\n\nInclude ALL CRITICAL emails, no limit\n\nInclude link: Use the message_id_url from the email as the \"link\" value\n\ncritical_meetings_today: Include today's meetings that are absolutely mandatory\n\nKeywords in title/description: \"urgent\", \"critical\", \"emergency\", \"immediate\", \"ASAP\", \"today\", \"blocking\", \"crisis\", \"fire drill\", \"red alert\", \"priority 1\", \"P0\", \"P1\"\n\nOr meetings where CTO is the main presenter/decision maker\n\nInclude link: Use the html_link from the meeting as the \"link\" value\n\n3. ACTION REQUIRED FROM MAILS:\nInclude emails with urgency = \"CRITICAL\", \"URGENT\", or \"HIGH\"\n\nExtract ALL action items from action_items array for each email\n\nEach action item becomes a separate object in the array\n\nFormat: Simple, actionable phrases for \"message\"\n\nInclude corresponding deadline for each action as \"deadline\"\n\nInclude link: Use the message_id_url from the corresponding email as the \"link\" value\n\n4. ACTION REQUIRED BEFORE MEETINGS:\nConsider ALL meetings in next 7 days\n\nExtract preparation actions from meeting descriptions\n\nIf no explicit preparation mentioned, infer based on meeting type:\n\nBoard/executive meetings â†’ \"Prepare slides/updates\"\n\nClient meetings â†’ \"Review account details\"\n\nTechnical reviews â†’ \"Review documents/code\"\n\nTeam meetings â†’ \"Review agenda/updates\"\n\nDeadline = meeting start time (format as \"Today HH:MM\" or \"Date HH:MM\")\n\nInclude link: Use the html_link from the meeting as the \"link\" value\n\n5. EMAIL DIGEST - CRITICAL REQUIREMENT: INCLUDE EVERY EMAIL\nMUST INCLUDE EVERY SINGLE EMAIL in these categories:\n\ncritical: ALL emails with urgency = \"CRITICAL\"\n\nExtract summary from email's summary field (2-3 lines)\n\nExtract action from action_items[0].action (or \"No action\" if empty)\n\nExtract deadline from action_items[0].deadline (or \"None\" if empty)\n\nInclude link: message_id_url from the email\n\nurgent: ALL emails with urgency = \"URGENT\"\n\nExtract summary from email's summary field (2-3 lines)\n\nExtract action from action_items[0].action (or \"No action\" if empty)\n\nExtract deadline from action_items[0].deadline (or \"None\" if empty)\n\nInclude link: message_id_url from the email\n\nhigh: ALL emails with urgency = \"HIGH\"\n\nExtract summary from email's summary field (2-3 lines)\n\nExtract action from action_items[0].action (or \"No action\" if empty)\n\nExtract deadline from action_items[0].deadline (or \"None\" if empty)\n\nInclude link: message_id_url from the email\n\nmedium: ALL emails with urgency = \"MEDIUM\"\n\nExtract summary from email's summary field (2-3 lines)\n\nExtract action from action_items[0].action (or \"No action\" if empty)\n\nExtract deadline from action_items[0].deadline (or \"None\" if empty)\n\nInclude link: message_id_url from the email\n\nVERIFICATION CHECK:\n\nTotal emails in email_digest = yesterdays_emails count - (LOW + INFORMATIONAL + PERSONAL emails)\n\n6. TODAY'S MEETINGS:\nInclude ONLY today's meetings\n\nFormat time as \"HH:MM-HH:MM\" (24-hour format)\n\nSummary: \"[Meeting title]: [Brief 5-7 word purpose]\"\n\nLocation: Physical location or \"Google Meet\"/\"Zoom\"/\"Teams\"\n\nInclude link: html_link from the meeting\n\nSort chronologically\n\n7. AWARENESS ITEMS:\nInclude ALL emails with urgency = \"LOW\", \"INFORMATIONAL\", or \"PERSONAL\"\n\nFormat: One-line summary only\n\nInclude type for filtering\n\nInclude link: message_id_url from the email\n\nGroup similar items when possible\n\nDATA MAPPING EXAMPLES:\nInput Email Example:\n\njson\n{\n  \"summary\": \"Production database outage affecting Client X. Team investigating root cause. Requires CTO escalation within 2 hours.\",\n  \"urgency\": \"CRITICAL\",\n  \"category\": \"Compliance/Security\",\n  \"action_items\": [\n    {\n      \"action\": \"Join emergency bridge call with engineering team\",\n      \"deadline\": \"Today 11:00 AM\",\n      \"owner\": \"CTO\",\n      \"priority\": \"High\"\n    }\n  ],\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"message_id_url\": \"https://mail.google.com/mail/u/0/#inbox/email_001\"\n}\nInput Meeting Example:\n\njson\n{\n  \"start_time\": \"2024-01-16T10:00:00\",\n  \"end_time\": \"2024-01-16T10:30:00\",\n  \"title\": \"Emergency Production Review\",\n  \"description\": \"URGENT: Review production outage with engineering team. Bring incident report and timeline.\",\n  \"location\": \"War Room 3\",\n  \"attendees\": [\"CTO\", \"Head of Engineering\", \"DevOps Lead\"],\n  \"html_link\": \"https://calendar.google.com/calendar/event?eid=abc123\"\n}\nCorresponding Output Mappings:\n\nFor Immediate Attention Required:\n\njson\n\"critical_emails\": [\n  {\n    \"message\": \"Production database outage affecting Client X - requires CTO escalation within 2 hours\",\n    \"link\": \"https://mail.google.com/mail/u/0/#inbox/email_001\"\n  }\n],\n\"critical_meetings_today\": [\n  {\n    \"message\": \"Emergency production review at 10:00 AM in War Room 3\",\n    \"link\": \"https://calendar.google.com/calendar/event?eid=abc123\"\n  }\n]\nFor Action Required from Mails:\n\njson\n\"action_required_from_mails\": [\n  {\n    \"message\": \"Join emergency bridge call with engineering team\",\n    \"deadline\": \"Today 11:00 AM\",\n    \"link\": \"https://mail.google.com/mail/u/0/#inbox/email_001\"\n  }\n]\nFor Action Required Before Meetings:\n\njson\n\"action_required_before_meetings\": [\n  {\n    \"message\": \"Review incident report and timeline for Emergency Production Review\",\n    \"deadline\": \"Today 10:00 AM\",\n    \"link\": \"https://calendar.google.com/calendar/event?eid=abc123\"\n  }\n]\nFor Email Digest (CRITICAL section):\n\njson\n\"critical\": [\n  {\n    \"summary\": \"Production database outage affecting Client X. Team investigating root cause. Requires CTO escalation within 2 hours.\",\n    \"action\": \"Join emergency bridge call with engineering team\",\n    \"deadline\": \"Today 11:00 AM\",\n    \"link\": \"https://mail.google.com/mail/u/0/#inbox/email_001\"\n  }\n]\nFor Today's Meetings:\n\njson\n{\n  \"time\": \"10:00-10:30\",\n  \"summary\": \"Emergency Production Review: Review production outage with engineering team\",\n  \"location\": \"War Room 3\",\n  \"link\": \"https://calendar.google.com/calendar/event?eid=abc123\"\n}\nFor Awareness Items:\n\njson\n{\n  \"type\": \"INFORMATIONAL\",\n  \"summary\": \"TechCrunch newsletter covering AI funding trends\",\n  \"link\": \"https://mail.google.com/mail/u/0/#inbox/newsletter_001\"\n}\nCOMPREHENSIVE INCLUSION GUARANTEE:\nTo ensure ALL emails are included in email_digest, follow this algorithm:\n\nCollect all input emails into arrays by urgency:\n\ncritical_emails = emails where urgency = \"CRITICAL\"\n\nurgent_emails = emails where urgency = \"URGENT\"\n\nhigh_emails = emails where urgency = \"HIGH\"\n\nmedium_emails = emails where urgency = \"MEDIUM\"\n\nother_emails = emails where urgency in [\"LOW\", \"INFORMATIONAL\", \"PERSONAL\"]\n\nFor each urgency category, process EVERY email:\n\nInclude in the corresponding email_digest section\n\nUse the exact summary from input\n\nExtract action and deadline from action_items[0]\n\nInclude message_id_url as link\n\nCount verification:\n\ntotal_emails_in_digest = len(critical) + len(urgent) + len(high) + len(medium)\n\ntotal_other_emails = len(other_emails)\n\ntotal_all_emails = total_emails_in_digest + total_other_emails\n\nThis should match yesterdays_emails count\n\nFINAL VALIDATION CHECKLIST:\nâœ… Every input email appears in exactly one place:\n\nCRITICAL/URGENT/HIGH/MEDIUM â†’ email_digest\n\nLOW/INFORMATIONAL/PERSONAL â†’ awareness_items\n\nâœ… Every meeting appears in appropriate sections:\n\nToday's meetings â†’ todays_meetings\n\nAll meetings â†’ action_required_before_meetings if prep needed\n\nâœ… All email entries include message_id_url as \"link\"\nâœ… All meeting entries include html_link as \"link\"\nâœ… Arrays are not empty unless no items exist for that category\nâœ… JSON structure is exact as specified\nâœ… No missing fields in any object\n\nFINAL INSTRUCTION:\nGenerate ONLY the complete JSON object. Do not include any explanatory text, comments, or markdown outside the JSON structure. Ensure every single input email and meeting is accounted for in the output with proper links."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        2224,
        1296
      ],
      "id": "3837daab-85db-41cb-aef9-34bd2677afdc",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "all calendar meets",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1552,
        1296
      ],
      "id": "24b84bae-8a5b-4157-a806-750e1c2e3d1a",
      "name": "Aggregate1"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "summary of email",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        896,
        1296
      ],
      "id": "e979ed52-6737-497f-82a6-5595850f91de",
      "name": "Aggregate2",
      "executeOnce": false
    },
    {
      "parameters": {
        "jsCode": "return [{\"all calendar meets\":$input.first().json['all calendar meets']},{\"summary of email\":$('Aggregate2').first().json['summary of email']}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1776,
        1296
      ],
      "id": "c9c04825-456b-4a46-88e4-67960a5b5805",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2000,
        1296
      ],
      "id": "d9623ff2-3230-4282-9c6b-d1a69bde3d3f",
      "name": "Aggregate3"
    },
    {
      "parameters": {
        "content": "Workflow 3 - Creating Task and Prioritization",
        "height": 400,
        "width": 2240
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        640,
        1136
      ],
      "typeVersion": 1,
      "id": "9f6b2729-ff8c-4577-b55d-e03f6c96a692",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "jsCode": "// In a Code node after your LLM\nconst rawOutput = $input.first().json.output;\n\n// Clean the output\nlet cleanOutput = rawOutput.trim();\n\n// Remove markdown code blocks\nif (cleanOutput.startsWith('```json')) {\n  cleanOutput = cleanOutput.replace(/^```json\\s*/i, '').replace(/\\s*```$/, '');\n} else if (cleanOutput.startsWith('```')) {\n  cleanOutput = cleanOutput.replace(/^```\\s*/, '').replace(/\\s*```$/, '');\n}\n\n// Parse the JSON\ntry {\n  const parsed = JSON.parse(cleanOutput);\n  \n  // Return in n8n format\n  return [{\n    json: parsed\n  }];\n} catch (error) {\n  // Try to extract JSON if wrapped in other text\n  const jsonMatch = cleanOutput.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) {\n    try {\n      const parsed = JSON.parse(jsonMatch[0]);\n      return [{\n        json: parsed\n      }];\n    } catch (e) {\n      throw new Error(`Failed to parse JSON: ${e.message}`);\n    }\n  }\n  throw new Error(`No valid JSON found in output: ${cleanOutput.substring(0, 200)}...`);\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2576,
        1296
      ],
      "id": "0cd0589c-4c43-4679-a14a-54ec6e22a242",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "model": "ministral-3b-latest",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
      "typeVersion": 1,
      "position": [
        2192,
        1440
      ],
      "id": "b4e6fbaf-b26a-4342-acf8-8d53dad2eafb",
      "name": "Mistral Cloud Chat Model",
      "credentials": {
        "mistralCloudApi": {
          "id": "r1gnyzVtkR4gGLJD",
          "name": "Mistral Cloud account 2"
        }
      }
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        800,
        512
      ],
      "id": "96fec76e-4c7d-4601-b527-7b49747b37b1",
      "name": "When Executed by Another Workflow",
      "disabled": true
    },
    {
      "parameters": {
        "model": "ministral-3b-latest",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
      "typeVersion": 1,
      "position": [
        1168,
        1008
      ],
      "id": "59389def-2e48-48ff-b853-7c826925a19a",
      "name": "Mistral Cloud Chat Model1",
      "credentials": {
        "mistralCloudApi": {
          "id": "r1gnyzVtkR4gGLJD",
          "name": "Mistral Cloud account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "emails_raw",
          "mode": "list",
          "cachedResultName": "emails_raw"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        832,
        848
      ],
      "id": "c51fa429-19b8-4ab1-a6d6-2f01033e2909",
      "name": "Get emails",
      "executeOnce": true,
      "credentials": {
        "postgres": {
          "id": "vUQsA6wGLOxEwh8P",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "emails_ai",
          "mode": "list",
          "cachedResultName": "emails_ai"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        672,
        1296
      ],
      "id": "81ca62cd-a05c-4c33-8d99-4ed9e24cc06f",
      "name": "get summary of the email",
      "executeOnce": true,
      "credentials": {
        "postgres": {
          "id": "vUQsA6wGLOxEwh8P",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "calendar_events",
          "mode": "list",
          "cachedResultName": "calendar_events"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1120,
        1296
      ],
      "id": "7e5e565b-d65b-4caf-8170-4f6c6e49fc9d",
      "name": "get calendar events",
      "executeOnce": true,
      "credentials": {
        "postgres": {
          "id": "vUQsA6wGLOxEwh8P",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "emails_ai",
          "mode": "list",
          "cachedResultName": "emails_ai"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "summary": "={{ $json.summary }}",
            "urgency": "={{ $json.urgency }}",
            "category": "={{ $json.category }}",
            "action_items": "={{ $json.action_items[0] }}",
            "created_at": "={{ $now }}",
            "message_id_url": "={{ $json.html_link || null}}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "summary",
              "displayName": "summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "importance",
              "displayName": "importance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "urgency",
              "displayName": "urgency",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "category",
              "displayName": "category",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "action_items",
              "displayName": "action_items",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "message_id_url",
              "displayName": "message_id_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        2032,
        848
      ],
      "id": "c918c397-68df-40db-966b-054d6fd30437",
      "name": "Insert summary of email in email ai table",
      "credentials": {
        "postgres": {
          "id": "vUQsA6wGLOxEwh8P",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "emails_raw",
          "mode": "list",
          "cachedResultName": "emails_raw"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "body": "={{ $json.text }}",
            "created_at": "={{ $now }}",
            "labels": "={{ $json.labelIds }}",
            "subject": "={{ $json.subject }}",
            "sender": "={{ $json.from.value }}",
            "message_id_url": "={{ $json.url }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "message_id_url",
              "displayName": "message_id_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "subject",
              "displayName": "subject",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "sender",
              "displayName": "sender",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            },
            {
              "id": "body",
              "displayName": "body",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "labels",
              "displayName": "labels",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1616,
        512
      ],
      "id": "a84e79e6-8460-4dd0-b2ae-ad9316752ef4",
      "name": "Insert mail in a email table",
      "credentials": {
        "postgres": {
          "id": "sgm1FkD3kU7pOVhf",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "calendar_events",
          "mode": "list",
          "cachedResultName": "calendar_events"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "event_id": "={{ $json.id }}",
            "start_time": "={{ $json.start.dateTime }}",
            "end_time": "={{ $json.end.dateTime }}",
            "created_at": "={{ $json.created }}",
            "title": "={{ $json.summary }}",
            "description": "={{ $json.description || null}}",
            "html_link": "={{ $json.htmlLink }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "event_id",
              "displayName": "event_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "description",
              "displayName": "description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "start_time",
              "displayName": "start_time",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "end_time",
              "displayName": "end_time",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "html_link",
              "displayName": "html_link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        2224,
        512
      ],
      "id": "890c4488-4bdc-43a9-ae8a-9bf63803cc26",
      "name": "Insert events in a calendar table",
      "credentials": {
        "postgres": {
          "id": "sgm1FkD3kU7pOVhf",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "daily_digest",
          "mode": "list",
          "cachedResultName": "daily_digest"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "digest_date": "={{ $now.toISODate() }}",
            "content": "={{ {object:$json.data} }}",
            "generated_at": "={{ $now }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "digest_date",
              "displayName": "digest_date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "content",
              "displayName": "content",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_at",
              "displayName": "generated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        3216,
        1296
      ],
      "id": "c6b8e3ca-ce32-4459-abaf-1972fdde15fd",
      "name": "Insert today digest in a daily digest table",
      "credentials": {
        "postgres": {
          "id": "vUQsA6wGLOxEwh8P",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "sparshgoyal199@gmail.com",
          "mode": "list",
          "cachedResultName": "sparshgoyal199@gmail.com"
        },
        "returnAll": true,
        "timeMax": "={{ $now.plus({ day: 1 }) }}",
        "options": {
          "orderBy": "startTime"
        }
      },
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.3,
      "position": [
        1808,
        512
      ],
      "id": "ecfb2169-66e2-4179-906c-1f9c245d362a",
      "name": "next day calendar events",
      "executeOnce": true,
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "F2XSJhlGSiX1UdSO",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        640,
        848
      ],
      "id": "22dbc133-9db5-4d7f-a78b-2fb0536e02d5",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2784,
        1296
      ],
      "id": "b08b3895-de50-4e27-bf6d-0031f39ca449",
      "name": "Aggregate4"
    }
  ],
  "pinData": {},
  "connections": {
    "Fetch Emails - Past 24 Hours": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Insert summary of email in email ai table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Insert mail in a email table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Insert events in a calendar table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate2": {
      "main": [
        [
          {
            "node": "get calendar events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Aggregate3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate3": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Aggregate4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mistral Cloud Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Fetch Emails - Past 24 Hours",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mistral Cloud Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Get emails": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get summary of the email": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get calendar events": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert summary of email in email ai table": {
      "main": [
        [
          {
            "node": "get summary of the email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert mail in a email table": {
      "main": [
        [
          {
            "node": "next day calendar events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert events in a calendar table": {
      "main": [
        []
      ]
    },
    "next day calendar events": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "Get emails",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate4": {
      "main": [
        [
          {
            "node": "Insert today digest in a daily digest table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "06e67253-9892-4bac-a80a-6ff8daeeb1e8",
  "meta": {
    "templateId": "5003",
    "templateCredsSetupCompleted": true,
    "instanceId": "e91500adc6b9d5c04c07524a89d5dd1212a1463f53b577bc9ee6ec31526e0c6a"
  },
  "id": "SAAoIK64M67YA4Vn",
  "tags": []
}